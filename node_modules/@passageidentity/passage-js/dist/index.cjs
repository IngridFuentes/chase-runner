"use strict";var me=Object.create;var M=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,_e=Object.prototype.hasOwnProperty;var Se=(o,e)=>{for(var t in e)M(o,t,{get:e[t],enumerable:!0})},z=(o,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of fe(e))!_e.call(o,i)&&i!==t&&M(o,i,{get:()=>e[i],enumerable:!(n=ge(e,i))||n.enumerable});return o};var W=(o,e,t)=>(t=o!=null?me(ye(o)):{},z(e||!o||!o.__esModule?M(t,"default",{value:o,enumerable:!0}):t,o)),we=o=>z(M({},"__esModule",{value:!0}),o);var Pe={};Se(Pe,{AllowedFallbackAuth:()=>le,AuthenticatorAttachment:()=>G,DisplayUnit:()=>de,Identifier:()=>ae,Passage:()=>K,PassageError:()=>l,PassageErrorCode:()=>k,PassageTokenStore:()=>L,PassageUserStatus:()=>ne,ReadOnlyTokenStore:()=>D,RequiredIdentifier:()=>ce,Session:()=>P,SocialConnection:()=>he,TokenStore:()=>q,User:()=>B,UserMetadataType:()=>ue,WebAuthnType:()=>V,WebSafeFonts:()=>pe,captureEvent:()=>Re,cleanSentryConfig:()=>se,isFullTokenStore:()=>b});module.exports=we(Pe);var d=class{encodeBytes(e){let n=btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_");return Y(n)}decodeBytes(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),n=Y(t);return Uint8Array.from(atob(n),h=>h.charCodeAt(0))}},Y=o=>{let e=o.indexOf("=");return o.slice(0,e===-1?o.length:e)};var l=class extends Error{constructor(t,n){super();this.name="PassageError",this.statusCode=n.status,this.statusText=n.statusText,this.message=this._parsePsgErrorResponse(t)}_parsePsgErrorResponse(t){try{return t=JSON.parse(t),t.error?t.error:""}catch{return t}}},k=(r=>(r[r.MultipleChoice=300]="MultipleChoice",r[r.MovedPermanantly=301]="MovedPermanantly",r[r.Found=302]="Found",r[r.SeeOther=303]="SeeOther",r[r.NotModified=304]="NotModified",r[r.TemporaryRedirect=307]="TemporaryRedirect",r[r.PermanentRedirect=308]="PermanentRedirect",r[r.BadRequest=400]="BadRequest",r[r.Unauthorized=401]="Unauthorized",r[r.PaymentRequired=402]="PaymentRequired",r[r.Forbidden=403]="Forbidden",r[r.NotFound=404]="NotFound",r[r.MethodNotAllowed=405]="MethodNotAllowed",r[r.NotAcceptable=406]="NotAcceptable",r[r.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",r[r.RequestTimeout=408]="RequestTimeout",r[r.Conflict=409]="Conflict",r[r.Gone=410]="Gone",r[r.LengthRequired=411]="LengthRequired",r[r.PreconditionFailed=412]="PreconditionFailed",r[r.PayloadTooLarge=413]="PayloadTooLarge",r[r.URITooLong=414]="URITooLong",r[r.UnsupportedMediaType=415]="UnsupportedMediaType",r[r.RangeNotSatisfiable=416]="RangeNotSatisfiable",r[r.ExpectationFailed=417]="ExpectationFailed",r[r.MisdirectedRequest=421]="MisdirectedRequest",r[r.UnprocessableEntity=422]="UnprocessableEntity",r[r.Locked=423]="Locked",r[r.FailedDependency=424]="FailedDependency",r[r.TooEarly=425]="TooEarly",r[r.UpgradeRequired=426]="UpgradeRequired",r[r.PreconditionRequired=428]="PreconditionRequired",r[r.TooManyRequests=429]="TooManyRequests",r[r.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",r[r.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",r[r.InternalServerError=500]="InternalServerError",r[r.NotImplemented=501]="NotImplemented",r[r.BadGateway=502]="BadGateway",r[r.ServiceUnavailable=503]="ServiceUnavailable",r[r.GatewayTimeout=504]="GatewayTimeout",r[r.HTTPVersionNotSupported=505]="HTTPVersionNotSupported",r[r.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",r[r.InsufficientStorage=507]="InsufficientStorage",r[r.LoopDetected=508]="LoopDetected",r[r.NotExtended=510]="NotExtended",r[r.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",r[r.PSGCredObjectDoesNotExist=700]="PSGCredObjectDoesNotExist",r[r.PSGParsePublicKeyForNewDeviceFailed=701]="PSGParsePublicKeyForNewDeviceFailed",r[r.PSGParsePublicKeyForLoginFailed=702]="PSGParsePublicKeyForLoginFailed",r[r.PSGCouldNotGetUserCredential=703]="PSGCouldNotGetUserCredential",r[r.PSGLoginRequired=704]="PSGLoginRequired",r[r.PSGSecureContextRequired=705]="PSGSecureContextRequired",r[r.PSGSocialSessionStorageError=706]="PSGSocialSessionStorageError",r))(k||{});var U=W(require("js-cookie"),1),J=new d,S=class{psgCredIDExists(e){let t=e.user.id,n=e.handshake.challenge.publicKey.allowCredentials,i=this.getPsgCredObj();if(!i)throw new l("Could not get psg_cred_obj",{status:700,statusText:"PSG Cred Object Does Not Exist"});let h=JSON.parse(i)[t];return h?n.find(f=>{if(J.encodeBytes(J.decodeBytes(f.id))===J.encodeBytes(J.decodeBytes(h)))return!0}):!1}setPsgCredID(e,t){if(!t)throw new l("Could not get user's credential",{status:703,statusText:"PSG Could Not Get User Credential"});let n=this.getPsgCredObj();if(n){let i=JSON.parse(n);i[e]=t==null?void 0:t.id,this.setPsgCredObj(JSON.stringify(i))}else this.setPsgCredObj(JSON.stringify({[e]:t==null?void 0:t.id}))}removeCredential(e){let t=this.getPsgCredObj();if(t===void 0)return;let n=JSON.parse(t);Object.keys(n).forEach(i=>{n[i]===e&&delete n[i]}),this.setPsgCredObj(JSON.stringify(n))}getPsgCredObj(){let e=U.default.get("psg_cred_obj"),t=localStorage.getItem("psg_cred_obj");if(e!==void 0)return U.default.set("psg_cred_obj",e,{expires:400,sameSite:"Strict"}),t===null&&localStorage.setItem("psg_cred_obj",e),e;if(t!==null)return U.default.set("psg_cred_obj",t,{expires:400,sameSite:"Strict"}),t}setPsgCredObj(e){U.default.set("psg_cred_obj",e,{expires:400,sameSite:"Strict"}),localStorage.setItem("psg_cred_obj",e)}};async function c(o){return o.ok?o.json():await o.text().then(e=>{throw new l(e,o)})}function Q(){let o=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,e=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./),t=e?parseInt(e[1]):0;return navigator.platform.indexOf("Win")!==-1&&o&&t===98}function X(o){let e=new Uint8Array(68);e.set(o.slice(0,68));let t=new Uint8Array(o.byteLength-68);t.set(o.slice(68,o.byteLength));let n=new Uint8Array(15),i=new Uint8Array(e.byteLength+n.byteLength+t.byteLength);i.set(e,0),i.set(n,e.byteLength),i.set(t,e.byteLength+n.byteLength);let h=i[30]+15;return i.set([h],30),i}var Z={URL:"https://auth.passage.id",version:"@passageidentity/passage-js 3.12.0",CAPTURE_EVENT_URL:"https://us-central1-passage-prod.cloudfunctions.net/capture-event",SENTRY_RELEASE:"passage-js@3.12.0-prod",SENTRY_PROJECT:"passage-js",SENTRY_PROJECT_DSN:"",SENTRY_PROJECT_ENV:"prod",SENTRY_PROJECT_VERSION:"3.12.0"};var g=Z;function s(o){var i;let e=new Headers(o),t=g.version,n=g.EXTRA_HEADERS;if(t&&e.append("Passage-Version",t),n){let h=((i=n.find(a=>a.hasOwnProperty("elementVersion")))==null?void 0:i.elementVersion)||null;h&&e.append("Passage-Element-Version",h)}return e}var D=class{getRefreshToken(){return Promise.resolve(void 0)}},q=class extends D{clearTokens(){return Promise.resolve()}},L=class extends q{constructor(){super(...arguments);this.noLocalStorage=typeof window>"u";this.noLocalStorageError=t=>"Failed to access localStorage or cookies. Must be run client-side."}getAuthToken(){if(this.noLocalStorage)return Promise.reject(this.noLocalStorageError("getAuthToken"));let t=localStorage.getItem("psg_auth_token");return t===null?Promise.resolve(""):Promise.resolve(t)}setAuthToken(t){if(this.noLocalStorage)return Promise.reject(this.noLocalStorageError("setAuthToken"));localStorage.setItem("psg_auth_token",t);let n=!this._isHttps()&&this._isLocalHost();return document.cookie=`psg_auth_token = ${t}; path=/ ${n?"":";secure"}`,Promise.resolve()}getRefreshToken(){this.noLocalStorage&&Promise.reject(this.noLocalStorageError("getRefreshToken"));let t=localStorage.getItem("psg_refresh_token");return t===null?Promise.resolve(void 0):Promise.resolve(t)}setRefreshToken(t){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("setRefreshToken")),localStorage.setItem("psg_refresh_token",t),Promise.resolve()}setTokens(t){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("setTokens")),this.setAuthToken(t.auth_token),t.refresh_token&&this.setRefreshToken(t.refresh_token),Promise.resolve()}clearTokens(){return this.noLocalStorage&&Promise.reject(this.noLocalStorageError("clearTokens")),localStorage.removeItem("psg_auth_token"),document.cookie="psg_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC;",localStorage.removeItem("psg_refresh_token"),Promise.resolve()}_isLocalHost(){return Boolean(window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))}_isHttps(){return location.protocol==="https:"}};function b(o){return o.setTokens!==void 0}var ke=o=>typeof o=="object"&&o!==null&&typeof o.auth_result<"u";function y(o,e){return ke(o)?(b(e)&&e.setTokens(o.auth_result),o):(console.warn("Not a valid auth response"),o)}var ee=require("@passageidentity/webauthnutils");var G=(n=>(n.Platform="platform",n.CrossPlatform="cross-platform",n.Any="any",n))(G||{});var F=new d,Te=new S,I=class{constructor(e,t,n){this.tokenStore=t;this.apiUrl=e+"/register/",this.identifier=n}async withWebAuthn(e){var m;let t=await fetch(this.apiUrl+"webauthn/start",{headers:s(),body:JSON.stringify({identifier:this.identifier,authenticator_attachment:(m=e==null?void 0:e.authenticatorAttachment)!=null?m:"platform"}),method:"POST"}).then(c),n=t.handshake.challenge.publicKey,{credential:i,transports:h}=await ee.CreateCredentialUtils.createCredential(n).catch(w=>{throw new l("error parsing public key for webAuthn",{status:702,statusText:"PSG Parse Public Key For Login Failed"})}),a=new Uint8Array(i==null?void 0:i.response.attestationObject);Q()&&(a=X(a));let f=t.user.id,_=await fetch(this.apiUrl+"webauthn/finish",{headers:s(),method:"POST",body:JSON.stringify({user_id:f,handshake_id:t.handshake.id,handshake_response:{rawId:F.encodeBytes(i==null?void 0:i.rawId),id:i==null?void 0:i.id,type:i==null?void 0:i.type,response:{attestationObject:F.encodeBytes(a),clientDataJSON:F.encodeBytes(i==null?void 0:i.response.clientDataJSON)},transports:h}})}).then(c).then(w=>y(w,this.tokenStore));return Te.setPsgCredID(f,i),_.auth_result}};var te=require("@passageidentity/webauthnutils"),N=new d,v=class{constructor(e,t,n){this.tokenStore=t;this.apiUrl=e+"/login/",this.identifier=n!=null?n:""}async withWebAuthn(e){let t=JSON.stringify({identifier:this.identifier}),n=this.identifier?t:void 0,i=await fetch(this.apiUrl+"webauthn/start",{headers:s(),method:"POST",body:n}).then(c),h=i.handshake.challenge.publicKey,a=await te.GetCredentialUtils.getCredential(h,e).catch(_=>{throw new l("error parsing public key for webAuthn",{status:702,statusText:"PSG Parse Public Key For Login Failed"})});return a?(await fetch(this.apiUrl+"webauthn/finish",{headers:s(),method:"POST",body:JSON.stringify({user_id:this.identifier?i.user.id:void 0,handshake_id:i.handshake.id,handshake_response:{id:a.id,rawId:N.encodeBytes(a.rawId),type:a.type,response:{clientDataJSON:N.encodeBytes(a.response.clientDataJSON),authenticatorData:N.encodeBytes(a.response.authenticatorData),signature:N.encodeBytes(a.response.signature),userHandle:N.encodeBytes(a.response.userHandle)}}})}).then(c).then(_=>y(_,this.tokenStore))).auth_result:{auth_token:"",redirect_url:""}}};var x=class{constructor(e){this.apiUrl=e}async appInfo(){return(await fetch(this.apiUrl,{headers:s(),method:"GET"}).then(c)).app}async identifierExists(e){return(await fetch(this.apiUrl+"/users?identifier="+encodeURIComponent(e),{headers:s(),method:"GET"}).then(c)).user}};var E=new d,T=class{constructor(e,t){this.tokenStore=t;this.apiUrl=e}async newRegister(e,t){return(await fetch(this.apiUrl+"/register/magic-link",{headers:s(),method:"POST",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname+window.location.search+window.location.hash,language:t})}).then(c)).magic_link}async newLogin(e,t){return(await fetch(this.apiUrl+"/login/magic-link",{headers:s(),method:"POST",body:JSON.stringify({identifier:e,magic_link_path:window.location.pathname+window.location.search+window.location.hash,language:t})}).then(c)).magic_link}async getStatus(e){return(await fetch(this.apiUrl+"/magic-link/status",{headers:s(),method:"POST",body:JSON.stringify({id:e})}).then(c).then(n=>y(n,this.tokenStore))).auth_result}async activate(e){return(await fetch(this.apiUrl+"/magic-link/activate",{headers:s(),method:"PATCH",body:JSON.stringify({magic_link:e})}).then(c).then(n=>y(n,this.tokenStore))).auth_result}_parsePublicKeyLogin(e){if(e.challenge=E.decodeBytes(e.challenge.toString()),e.allowCredentials){for(let t=0;t<e.allowCredentials.length;t++){let n=e.allowCredentials[t];n.id=E.decodeBytes(n.id.toString())}return e}return e}_parsePublicKeyNewDevice(e){return e.challenge=E.decodeBytes(e.challenge.toString()),e.user.id=E.decodeBytes(e.user.id.toString()),e}};var R=class{constructor(e,t){this.tokenStore=t;this.apiUrl=e}async newRegister(e,t){return await fetch(this.apiUrl+"/register/otp",{headers:s(),method:"POST",body:JSON.stringify({identifier:e,language:t})}).then(c)}async newLogin(e,t){return await fetch(this.apiUrl+"/login/otp",{headers:s(),method:"POST",body:JSON.stringify({identifier:e,language:t})}).then(c)}async activate(e,t){return(await fetch(this.apiUrl+"/otp/activate",{headers:s(),method:"POST",body:JSON.stringify({otp:e,otp_id:t})}).then(c).then(i=>y(i,this.tokenStore))).auth_result}};var ne=(n=>(n.ACTIVE="active",n.INACTIVE="inactive",n.PENDING="pending",n))(ne||{}),V=(n=>(n.Platform="platform",n.Passkey="passkey",n.SecurityKey="security_key",n))(V||{});var $=W(require("jwt-decode"),1);function O(o){return`${g.URL}/v1/apps/${o}`}var P=class{constructor(e,t){this.tokenStore=t;this.apiUrl=O(e)+"/tokens/"}async authGuard(){try{let e=await this.tokenStore.getAuthToken(),t=(0,$.default)(e,{header:!0}),n=(0,$.default)(e);return!!(n!==void 0&&t!==void 0&&this._validJWTPayload(n)&&this._validJWTHeader(t))}catch{return!1}}async signOut(){let e=await this.tokenStore.getRefreshToken();return e?fetch(`${this.apiUrl}?`+new URLSearchParams({refresh_token:e}),{method:"DELETE"}).then(({status:t})=>t===200).finally(()=>{b(this.tokenStore)&&this.tokenStore.clearTokens()}):(b(this.tokenStore)&&this.tokenStore.clearTokens(),!0)}async getAuthToken(){let e=await this.tokenStore.getAuthToken();if(await this.tokenStore.getRefreshToken()===void 0){if(!e)throw new l("Login required",{status:704,statusText:"Login required"});return e}if(e){let n=(0,$.default)(e);if(n!==void 0&&this._validJWTPayload(n))return Promise.resolve(e)}return this.refresh().then(n=>n.auth_token)}async refresh(){let e=new l("Login required",{status:704,statusText:"Login required"}),t=await this.tokenStore.getRefreshToken();return t?fetch(this.apiUrl,{headers:s(),method:"POST",body:JSON.stringify({refresh_token:t})}).then(c).then(n=>(b(this.tokenStore)&&this.tokenStore.setTokens(n.auth_result),n.auth_result)).catch(()=>{throw e}):Promise.reject(e)}_validJWTPayload(e){let t=["exp","iss","sub"],n=Math.floor(Date.now()/1e3);return t.forEach(i=>{if(!(i in e))return!1}),!(e.exp&&n>e.exp)}_validJWTHeader(e){let t={alg:"RS256",typ:"JWT"};return!(e.alg!==t.alg||e.typ!==t.typ)}};var C=new d,re=new S,B=class{constructor(e,t){this.tokenStore=t;this.apiUrl=O(e)+"/currentuser",this.session=new P(e,this.tokenStore)}async userInfo(){let e=await this._getToken(),t=await fetch(this.apiUrl,{method:"GET",headers:s({Authorization:`Bearer ${e}`})}).then(async n=>n.status!==200?void 0:await n.json()).catch(n=>{throw new l("Failed to fetch current user.",{status:404,statusText:"Not Found"})});return t==null?void 0:t.user}async changeEmail(e,t){let n=await this._getToken();return(await fetch(`${this.apiUrl}/email`,{method:"PATCH",headers:s({Authorization:`Bearer ${n}`,"Content-Type":"application/json"}),body:JSON.stringify({new_email:e,language:t})}).then(c)).magic_link}async changePhone(e,t){let n=await this._getToken();return(await fetch(`${this.apiUrl}/phone`,{method:"PATCH",headers:s({Authorization:`Bearer ${n}`,"Content-Type":"application/json"}),body:JSON.stringify({new_phone:e,language:t})}).then(c)).magic_link}async editDevice(e,t){if(e===""||e===void 0)throw new l("A deviceID is required for an edit device request.",{status:400,statusText:"Bad Request"});if(Object.keys(t).length===0)throw new l("Edit device request must not have an empty request body.",{status:400,statusText:"Bad Request"});let n=await this._getToken();return(await fetch(`${this.apiUrl}/devices/${e}`,{method:"PATCH",headers:s({Authorization:`Bearer ${n}`,"Content-Type":"application/json"}),body:JSON.stringify({...t})}).then(c)).device}async listDevices(){let e=await this._getToken();return(await fetch(`${this.apiUrl}/devices/`,{method:"GET",headers:s({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}).then(c)).devices}async addDevice(e){var _;let t=await this._getToken(),n=await fetch(this.apiUrl+"/devices/start",{headers:s({Authorization:`Bearer ${t}`}),body:JSON.stringify({authenticator_attachment:(_=e==null?void 0:e.authenticatorAttachment)!=null?_:"platform"}),method:"POST"}).then(c),i=await navigator.credentials.create({publicKey:this._parsePublicKey(n.handshake.challenge.publicKey)}).catch(m=>{throw new l("failed to parse public key",{status:701,statusText:"PSG Parse Public Key For New Device Failed"})}).then(m=>m),h=[];(i==null?void 0:i.response.getTransports)&&typeof(i==null?void 0:i.response.getTransports)=="function"&&(h=i==null?void 0:i.response.getTransports());let a=n.user.id,f=await fetch(this.apiUrl+"/devices/finish",{headers:s({Authorization:`Bearer ${t}`}),method:"POST",body:JSON.stringify({user_id:a,handshake_id:n.handshake.id,handshake_response:{rawId:C.encodeBytes(i==null?void 0:i.rawId),id:i==null?void 0:i.id,type:i==null?void 0:i.type,response:{attestationObject:C.encodeBytes(i==null?void 0:i.response.attestationObject),clientDataJSON:C.encodeBytes(i==null?void 0:i.response.clientDataJSON)},transports:h}})}).then(c);return re.setPsgCredID(a,i),f.device}async deleteDevice(e){let t=typeof e=="string"?e:e.id,n=typeof e=="string"?void 0:e.cred_id;if(!t)throw new l("A deviceID is required to delete a device.",{status:404,statusText:"Not Found"});let i=!1,h=await this._getToken();return i=await fetch(`${this.apiUrl}/devices/${t}`,{method:"DELETE",headers:s({Authorization:`Bearer ${h}`,"Content-Type":"application/json"})}).then(async a=>a.ok?!0:await a.text().then(f=>{throw new l(f,a)})),i&&n!==void 0&&re.removeCredential(n),i}async getMetadata(){let e=await this._getToken();return(await fetch(`${this.apiUrl}/user-metadata`,{method:"GET",headers:s({Authorization:`Bearer ${e}`})}).then(c)).user_metadata}async updateMetadata(e){let t=await this._getToken();return(await fetch(`${this.apiUrl}/user-metadata`,{method:"PATCH",headers:s({Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),body:JSON.stringify({user_metadata:e})}).then(c)).user}_parsePublicKey(e){return e.challenge=C.decodeBytes(e.challenge.toString()),e.user.id=C.decodeBytes(e.user.id.toString()),e}async _getToken(){return await this.session.getAuthToken()}};var ie=require("@passageidentity/webauthnutils"),j=class{async getBrowserInfo(){let e=await ie.GetCredentialUtils.getCredentialAvailable();return{createPassKeySupported:e.syncedCredential,getPassKeySupported:e.syncedCredential,conditionalUISupported:e.conditionalUI}}};var H=require("@passageidentity/webauthnutils");var be=new d,A=class{constructor(e,t){this.tokenStore=t;this.apiUrl=e+"/social"}async authorizeWith(e){if(!window.isSecureContext)throw new l("Passage Social Login requires a secure context (HTTPS or localhost)",{status:705,statusText:"Secure context required"});sessionStorage.setItem("oauth2Connection",e);let t=await this._getQueryParams(e);window.location.href=`${this.apiUrl}/authorize?${t}`}async exchangeToken(e){let t=sessionStorage.getItem("oauth2Verifier");if(t===null||t===""||t===" ")throw new l("Social login verifier not found",{status:706,statusText:"Social login verifier not found"});let n=`${this.apiUrl}/token?code=${e}&verifier=${t}`;return(await fetch(n,{headers:s(),method:"GET"}).then(c).then(h=>y(h,this.tokenStore))).auth_result}async _getQueryParams(e){let t=window.location.href,n=this._getRandomString(32);sessionStorage.setItem("oauth2State",n);let i=await this._getCodeChallenge(),a={redirect_uri:t,state:n,code_challenge:i,code_challenge_method:"S256",connection_type:e};return new URLSearchParams(a).toString()}async _getCodeChallenge(){let e=this._getRandomString(32);return sessionStorage.setItem("oauth2Verifier",e),await this._sha256Hash(e)}_getRandomString(e){return window.crypto.getRandomValues(new Uint8Array(e)).toString().replace(/,/g,"")}async _sha256Hash(e){let n=new TextEncoder().encode(e),i=await window.crypto.subtle.digest("SHA-256",n);return be.encodeBytes(i)}};var K=class{constructor(e,t){this.appID=e;this.fullUrl=O(this.appID),(t==null?void 0:t.tokenStore)===void 0?this.tokenStore=new L:this.tokenStore=t.tokenStore,this.extraHeaders=t==null?void 0:t.extraHeaders,g.EXTRA_HEADERS=this.extraHeaders}credIDExists(e){let t=new S().getPsgCredObj();return t?!!JSON.parse(t)[e]:!1}async register(e,t){return await new I(this.fullUrl,this.tokenStore,e).withWebAuthn(t)}async login(e){return await new v(this.fullUrl,this.tokenStore,e).withWebAuthn()}async loginConditional(e){return await new v(this.fullUrl,this.tokenStore).withWebAuthn({mediation:"conditional",signal:e})}async appInfo(){return await new x(this.fullUrl).appInfo()}async browserInfo(){return await new j().getBrowserInfo()}async getCredentialAvailable(){return await H.GetCredentialUtils.getCredentialAvailable()}async createCredentialAvailable(){return await H.CreateCredentialUtils.createCredentialAvailable()}checkWebauthnConfig(e){let t=!0;return e.auth_origin.replace(/\/$/,"")!=window.location.origin.replace(/\/$/,"")&&(console.error('The auth_origin configured for webauthn in your app settings does not match the "origin" of your current URL.  Please reconfigure this in the admin console. (Your current "origin" is `'+window.location.origin+"`) Passage will continue to work with other authentication methods."),t=!1),t}async isWebauthnSupported(e){let t=await H.CreateCredentialUtils.createCredentialAvailable();return e?t.securityKey:t.platform}async identifierExists(e){let n=await new x(this.fullUrl).identifierExists(e);return n&&(n.hasPasskey=n.webauthn_types.includes("passkey"),n)}async newRegisterMagicLink(e,t){return await new T(this.fullUrl,this.tokenStore).newRegister(e,t)}async newLoginMagicLink(e,t){return await new T(this.fullUrl,this.tokenStore).newLogin(e,t)}async magicLinkActivate(e){return await new T(this.fullUrl,this.tokenStore).activate(e)}async getMagicLinkStatus(e){return await new T(this.fullUrl,this.tokenStore).getStatus(e)}async newRegisterOneTimePasscode(e,t){return await new R(this.fullUrl,this.tokenStore).newRegister(e,t)}async newLoginOneTimePasscode(e,t){return await new R(this.fullUrl,this.tokenStore).newLogin(e,t)}async oneTimePasscodeActivate(e,t){return await new R(this.fullUrl,this.tokenStore).activate(e,t)}getCurrentUser(){return new B(this.appID,this.tokenStore)}getCurrentSession(){return new P(this.appID,this.tokenStore)}async createUser(e){return(await fetch(`${this.fullUrl}/users`,{headers:s(),body:JSON.stringify({...e}),method:"POST"}).then(c)).user}async authorizeWith(e){await new A(this.fullUrl,this.tokenStore).authorizeWith(e)}async finishSocialAuthentication(e){return await new A(this.fullUrl,this.tokenStore).exchangeToken(e)}};var oe=require("serialize-error");var se=o=>JSON.parse(JSON.stringify(o,(e,t)=>{if(!(t==null||t==="undefined"))return t})),Re=async o=>{try{let{error:e,message:t,sentryConfig:{url:n=g.CAPTURE_EVENT_URL,project:i=g.SENTRY_PROJECT,dsn:h=g.SENTRY_PROJECT_DSN,environment:a=g.SENTRY_PROJECT_ENV,release:f=g.SENTRY_RELEASE,version:_=g.SENTRY_PROJECT_VERSION}={}}=o,m=se({project:i,dsn:h,environment:a,url:n,release:f,version:_});if(!(m.project&&m.url)||!(e||t))return;let w={project:m.project,dsn:m.dsn,environment:m.environment,release:m.release,version:m.version};t&&(w={...w,message:t}),e&&(w={...w,serializedError:(0,oe.serializeError)(typeof e=="string"?new Error(e):e)}),await fetch(m.url,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(w)})}catch(e){console.error(e)}};var ae=(n=>(n.email="email",n.phone="phone",n.both="both",n))(ae||{}),ce=(i=>(i.Phone="phone",i.Email="email",i.Both="both",i.Either="either",i))(ce||{}),ue=(a=>(a.STRING="string",a.BOOLEAN="boolean",a.INTEGER="integer",a.DATE="date",a.PHONE="phone",a.EMAIL="email",a))(ue||{}),le=(n=>(n.LoginCode="otp",n.MagicLink="magic_link",n.None="none",n))(le||{}),he=(t=>(t.Google="google",t.Github="github",t))(he||{}),pe=(p=>(p.ANDALE_MONO="Andal\xE9 Mono",p.ARIAL="Arial",p.ARIAL_BLACK="Arial Black",p.BASKERVILLE="Baskerville",p.BRADLEY_HAND="Bradley Hand",p.BRUSH_SCRIPT_MT="Brush Script MT",p.COMIC_SANS_MS="Comic Sans MS",p.COURIER="Courier",p.GEORGIA="Georgia",p.GILL_SANS="Gill Sans",p.HELVETICA="Helvetica",p.IMPACT="Impact",p.LUCIDA="Lucida",p.LUMINARI="Luminari",p.MONACO="Monaco",p.PALATINO="Palatino",p.TAHOMA="Tahoma",p.TIMES_NEW_ROMAN="Times New Roman",p.TREBUCHET_MS="Trebuchet MS",p.VERDANA="Verdana",p))(pe||{}),de=(i=>(i.Seconds="s",i.Minutes="m",i.Hours="h",i.Days="d",i))(de||{});0&&(module.exports={AllowedFallbackAuth,AuthenticatorAttachment,DisplayUnit,Identifier,Passage,PassageError,PassageErrorCode,PassageTokenStore,PassageUserStatus,ReadOnlyTokenStore,RequiredIdentifier,Session,SocialConnection,TokenStore,User,UserMetadataType,WebAuthnType,WebSafeFonts,captureEvent,cleanSentryConfig,isFullTokenStore});
//#