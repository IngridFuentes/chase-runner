"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,l=(e,t,n)=>new Promise(((a,i)=>{var o=e=>{try{l(n.next(e))}catch(t){i(t)}},r=e=>{try{l(n.throw(e))}catch(t){i(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,r);l((n=n.apply(e,t)).next())})),s=require("./customElements.js"),c=require("./useUpdateUser.js");function u(e){return null==e||""===e||" "===e}var d=(e=>(e.phone="PHONE",e.email="EMAIL",e))(d||{});function p(){const e=s.ref();return s.watch(e,(()=>{void 0!==e.value&&null!==e.value&&e.value.focus()})),{autofocusButton:e}}const f={class:"identifier-form"},v={class:"has-text-centered"},g=(e=>(s.pushScopeId("data-v-1ea7af8c"),e=e(),s.popScopeId(),e))((()=>s.createBaseVNode("br",null,null,-1))),m={class:"identifier-text"},y=["onSubmit"],h=["autocomplete","inputmode","placeholder","onInput"],k={class:"flex-row flex-center"},b=["onClick"],B={key:0,style:{"margin-top":"30px"},class:"link has-text-centered"},w=["onClick"],V=s.defineComponent({__name:"ValidatedIdentifierForm",props:{validationError:{default:""},identifier:{},countryCode:{},identifierMode:{},showWelcomeBack:{type:Boolean,default:!1},conditionalUI:{type:Boolean,default:!1}},emits:["onSubmit","update:validationError","update:identifier","update:countryCode","update:showWelcomeBack"],setup(e,{emit:t}){const n=e,{t:a}=s.useLocale(),i=s.ref(""),o=s.ref(),r=s.ref(),{autofocusButton:V}=p(),{passage:_}=s.usePassage(),I=s.computed((()=>n.showWelcomeBack)),C=s.computed((()=>{let e;switch(n.identifierMode){case s.ce.phone:e=a("phone-number");break;case s.ce.email:e=a("email-address");break;case s.ce.both:e=a("email-or-phone-number")}return e.charAt(0).toUpperCase()+e.slice(1)})),N=s.computed((()=>"example@email.com")),x=s.computed((()=>n.identifierMode===s.ce.phone?"tel":"email")),S=s.computed((()=>{var e;return n.conditionalUI?`${x.value} webauthn`:null!=(e=x.value)?e:""})),E=s.computed({get:()=>n.identifier,set(e){t("update:identifier",e)}});function D(){var e;if(!E.value)return"";let t=E.value;return I.value||(t=A()?null!=(e=null==U?void 0:U.getNumber())?e:"":E.value),t.trim().toLowerCase()}const T=s.computed((()=>u(n.validationError)?u(i.value)?"":i.value:n.validationError));function L(){i.value="",t("update:validationError","")}function R(){return l(this,null,(function*(){if(!function(){if(""===D()){let e="";switch(n.identifierMode){case s.ce.phone:e=a("enter-a-phone-number");break;case s.ce.email:e=a("enter-an-email-address");break;case s.ce.both:e=a("enter-an-email-or-phone-number")}return i.value=e,!1}if(n.identifierMode===s.ce.email&&!M())return i.value=a("enter-a-valid-email-address"),!1;if(n.identifierMode===s.ce.phone&&!A())return i.value=a("enter-a-valid-phone-number"),!1;if(n.identifierMode===s.ce.both&&!A()&&!M())return i.value=a("enter-a-valid-email-or-phone-number"),!1;return!0}())return;let e,o,r,l=!1,c=[],u="";try{const t=yield _.identifierExists(D());null!==t?(e=!0,r=t.status,u=t.id,o=t.email_verified,l=t.phone_verified,c=t.webauthn_types):(e=!1,r=s.re.INACTIVE)}catch(p){let e;switch(n.identifierMode){case s.ce.email:e=a("enter-a-valid-email-address");break;case s.ce.phone:e=a("enter-a-valid-phone-number");break;case s.ce.both:e=a("enter-a-valid-email-or-phone-number")}return void(i.value=e)}t("onSubmit",{identifier:D(),identifierExists:e,identifierType:A()?d.phone:d.email,userStatus:r,userID:u,emailVerified:o,phoneVerified:l,webauthnTypes:c})}))}function M(){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(D())}function A(){return I.value?F():void 0!==U&&U.isValidNumber()}let U;function P(){void 0===U&&(o.value.addEventListener("countrychange",(()=>{var e;t("update:countryCode",null!=(e=null==U?void 0:U.getSelectedCountryData().iso2)?e:"")})),U=c.intlTelInput(o.value,{initialCountry:n.countryCode,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:r.value,autoPlaceholder:"aggressive"}),o.value.focus())}function F(){return/^\+$|^\+?[0-9,(,),\-, ]+$/.test(E.value.trim())}s.onMounted((()=>{n.conditionalUI&&function(){const e=$.value.getRootNode().host;void 0!==e&&($.value.appendChild(function(){const e=document.createElement("style");return e.appendChild(document.createTextNode("\n      .psg-input{\n        -webkit-appearance: none;\n        -moz-appearance: none;\n        box-sizing: border-box;\n        color: var(--passage-input-text-color, var(--passage-body-text-color-default));\n        font-family: var(--passage-body-font-family, var(--passage-body-font-family-default));\n        font-size: var(--passage-body-font-size, var(--passage-body-font-size-default));\n        font-weight: var(--passage-body-font-weight, var(--passage-body-font-weight-default));\n\n        min-height: 40px;\n        width: 100%;\n\n        padding-left: 10px;\n        padding-right: 10px;\n        margin: 0;\n\n        background-color: var(--passage-input-box-background-color, var(--passage-input-box-background-color-default));\n        border-style: solid;\n        border-color: var(--passage-control-border-color, var(--passage-control-border-color-default));\n        border-width: 1px;\n        border-radius: var(--passage-input-box-border-radius, var(--passage-input-box-border-radius-default));\n\n        transition: all 0.3s;\n\n        text-overflow: ellipsis;\n      }\n\n      .psg-input:focus{\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n\n      .psg-input:active{\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n\n      .psg-input.has-error{\n        border-color: var(--passage-error-color, var(--passage-error-color-default));\n      }\n      .psg-input.is-danger{\n        border-color: var(--passage-error-color, var(--passage-error-color-default));\n      }\n      .iti {\n        width: 100%;\n      }\n\n        .iti__country-list {\n            border-radius: 6px;\n        }\n\n        .iti__country {\n            padding: 5px 10px;\n        }\n\n        .iti__selected-flag {\n            border-top-left-radius: var(--passage-control-border-radius, var(--passage-input-box-border-radius-default));\n            border-bottom-left-radius: var(--passage-control-border-radius, var(--passage-input-box-border-radius-default));\n        }\n\n    .iti--container {\n        top: unset !important;\n        left: unset !important;\n    }")),e}()),$.value.appendChild(function(){const e=document.createElement("link");return e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.16/css/intlTelInput.css",e}()),e.appendChild($.value))}(),n.identifierMode===s.ce.phone&&P()})),n.identifierMode===s.ce.both&&s.watch(E,(()=>{F()?P():void 0!==U&&(U.destroy(),U=void 0,o.value&&o.value.focus())}));const O=s.computed((()=>n.countryCode));function j(){t("update:showWelcomeBack",!1),E.value=""}s.watch(O,(e=>{null==U||U.setCountry(e)}));const $=s.ref();return s.onBeforeUnmount((()=>{$.value.remove()})),(e,t)=>(s.openBlock(),s.createElementBlock("div",f,[s.withDirectives(s.createBaseVNode("div",v,[s.createTextVNode(s.toDisplayString(s.unref(a)("welcome-back-sign-in-as")),1),g,s.createBaseVNode("strong",m,s.toDisplayString(E.value),1)],512),[[s.vShow,e.showWelcomeBack]]),s.withDirectives(s.createBaseVNode("div",null,[s.createBaseVNode("div",{class:"label",ref:"labelRef"},s.toDisplayString(C.value),513),s.createBaseVNode("form",{ref_key:"identifierForm",ref:$,slot:"loginInput",onSubmit:s.withModifiers(R,["prevent"])},[s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),type:"text",class:s.normalizeClass(["input psg-input",{"is-danger":T.value}]),part:"input",autocomplete:S.value,inputmode:x.value,id:"identifier",placeholder:N.value,onInput:s.withModifiers(L,["prevent"]),"data-test":"identifier-input",ref_key:"identifierInput",ref:o},null,42,h),[[s.vModelText,E.value]])],40,y),s.renderSlot(e.$slots,"loginInput",{},void 0,!0)],512),[[s.vShow,!e.showWelcomeBack]]),s.createBaseVNode("div",{ref_key:"controlContainer",ref:r,style:{width:"100%"}},null,512),s.createBaseVNode("div",{style:s.normalizeStyle(`text-align: ${I.value?"center":"left"};`),class:"help is-danger error-message","data-test":"validation-error"},s.toDisplayString(T.value),5),s.renderSlot(e.$slots,"metadataFields",{},void 0,!0),s.createBaseVNode("div",k,[s.createBaseVNode("button",{class:"button is-primary",part:"button","data-test":"continue-button",ref_key:"autofocusButton",ref:V,onClick:s.withModifiers(R,["prevent"])},s.toDisplayString(s.unref(a)("continue")),9,b)]),I.value?(s.openBlock(),s.createElementBlock("div",B,[s.createBaseVNode("a",{onClick:s.withModifiers(j,["prevent"]),role:"button",class:"body-link","data-test":"register-link"},s.toDisplayString(s.unref(a)("switch-account")),9,w)])):s.createCommentVNode("",!0)]))}});var _=s._export_sfc(V,[["__scopeId","data-v-1ea7af8c"]]),I=(e=>(e.onLoaded="onLoaded",e.onRegisterDevice="onRegisterDevice",e.onVerifyIdentity="onVerifyIdentity",e.onMagicLinkLogin="onMagicLinkLogin",e.onMagicLinkRegister="onMagicLinkRegister",e.onMagicLinkActivated="onMagicLinkActivated",e.onMagicLinkActivateSuccess="onMagicLinkActivateSuccess",e.onOneTimePasscodeLogin="onOneTimePasscodeLogin",e.onOneTimePasscodeRegister="onOneTimePasscodeRegister",e.onOneTimePasscodeActivated="onOneTimePasscodeActivated",e.onOneTimePasscodeActivateSuccess="onOneTimePasscodeActivateSuccess",e))(I||{});const C=()=>!0,N=e=>{window.location.href=e.redirect_url},x=()=>{},S=s.ref(C),E=s.ref(N),D=s.ref(x);function T(e){S.value=void 0!==e?e:C}function L(e){E.value=void 0!==e?e:N}function R(e){D.value=void 0!==e?e:x}function M(){return{beforeAuth:s.readonly(S),onSuccess:s.readonly(E),onEvent:s.readonly(D),setBeforeAuth:T,setOnSuccess:L,setOnEvent:R}}function A(e,t,n){return l(this,null,(function*(){const{browserFeatures:a,appInfo:i,router:o}=t,{emitEvent:r}=H(),{identifier:l,identifierType:c,webauthnTypes:u,emailVerified:p,phoneVerified:f,userID:v}=e,g=i.auth_fallback_method===s.he.None;if(0===u.length&&g)return void o.push(wa);const m=u.includes(s.W.Passkey),y=u.includes(s.W.Platform),h=u.includes(s.W.SecurityKey),k=function(e,t,n,a){if(e.require_identifier_verification&&(a===d.email&&!t||a===d.phone&&!n))return!0;return!1}(i,p,f,c),b=a.platform&&y&&n.credIDExists(v),B=(a.syncedCredential||a.crossDeviceCredential)&&m,w=a.securityKey&&h,V=a.platform&&g,_=m&&a.platform&&!navigator.credentials.get.toString().includes("[native code]");!k&&(B||b||w||V||_)?(M().onEvent.value(I.onVerifyIdentity),o.push(ya,{identifier:l,identifierType:c,appInfo:i})):r({type:F.FallbackAuth,payload:{identifier:l,identifierType:c,userInitiated:!1,identifierVerifying:k,setupNewDevice:a.platform}})}))}function U(e,t){const{authState:n,appInfo:a,router:i}=t;switch(n.userInitiatedFallback=e.userInitiated,a.auth_fallback_method){case s.he.LoginCode:!function(e){const{identifier:t,userIsRegistering:n}=e;n?M().onEvent.value(I.onOneTimePasscodeRegister,{identifier:t}):M().onEvent.value(I.onOneTimePasscodeLogin)}(e),i.push(ka,e);break;case s.he.MagicLink:!function(e){const{identifier:t,userIsRegistering:n}=e;n?M().onEvent.value(I.onMagicLinkRegister,{identifier:t}):M().onEvent.value(I.onMagicLinkLogin)}(e),i.push(ma,e);break;case s.he.None:i.push(Ba)}}function P(e,t,n){return l(this,null,(function*(){u(e.authResult.auth_token)||u(e.authResult.redirect_url)||(yield function(e,t,n){return l(this,null,(function*(){if(n&&"string"==typeof n)return void localStorage.setItem("psg_last_login",n);let a=n;if(void 0===n)try{a=yield t.getCurrentUser().userInfo()}catch(o){console.error("Failed to fetch current user, auth token likely missing or invalid",o)}if(void 0===a)return;let i="";switch(e.allowed_identifier){case s.ce.email:i=a.email;break;case s.ce.phone:i=a.phone;break;case s.ce.both:i=a.email?a.email:a.phone}localStorage.setItem("psg_last_login",i)}))}(t.appInfo,n,e.identifier),M().onSuccess.value(e.authResult))}))}var F=(e=>(e.CreatedUser="CreatedUser",e.ChangeIdentifier="ChangeIdentifier",e.LoginUser="LoginUser",e.FallbackAuth="FallbackAuth",e.AuthSuccess="AuthSuccess",e.FallbackAuthSuccess="FallbackAuthSuccess",e))(F||{});class O{constructor(e,t,n){this.appInfo=e,this.router=t,this.passage=n,this.authState={userInitiatedFallback:!1},this.authOriginValid=!1,this.browserFeatures={securityKey:!1,platform:!1,syncedCredential:!1,crossDeviceCredential:!1,conditionalUI:!1,isAvailable:!1}}initializeEventHandler(){return l(this,null,(function*(){this.authOriginValid=this.passage.checkWebauthnConfig(this.appInfo),this.authOriginValid&&(this.browserFeatures=yield this.passage.getCredentialAvailable(),function(){var e;const t=new s.UAParser;return(null==(e=t.getBrowser().name)?void 0:e.toLowerCase().includes("safari"))&&parseFloat(t.getBrowser().version||"")<16.4}()&&(this.browserFeatures.conditionalUI=!1)),this.checkMagicLink()||this.router.push(this.router.homeRoute,{appInfo:this.appInfo,conditionalUI:this.browserFeatures.conditionalUI})}))}handleEvent(e){return l(this,null,(function*(){switch(e.type){case"CreatedUser":!function(e,t){const{appInfo:n,router:a,browserFeatures:i}=t,{identifier:o,identifierType:r}=e,{emitEvent:l}=H();i.securityKey&&!n.require_identifier_verification?(M().onEvent.value(I.onRegisterDevice,{identifier:o}),a.push(ga,{identifier:o,identifierType:r,appInfo:n,browserFeatures:i})):l({type:F.FallbackAuth,payload:{identifier:o,identifierType:r,identifierVerifying:n.require_identifier_verification,userIsRegistering:!0,userInitiated:!1}})}(e.payload,this.eventHandlerState);break;case"ChangeIdentifier":!function(e){const{appInfo:t,router:n,browserFeatures:a}=e;n.push(n.homeRoute,{appInfo:t,conditionalUI:a.conditionalUI,changeEmail:!0})}(this.eventHandlerState);break;case"LoginUser":A(e.payload,this.eventHandlerState,this.passage);break;case"FallbackAuth":U(e.payload,this.eventHandlerState);break;case"AuthSuccess":P(e.payload,this.eventHandlerState,this.passage);break;case"FallbackAuthSuccess":!function(e,t){const{webauthnAllowed:n,authState:a,router:i}=t;!n||a.userInitiatedFallback?H().emitEvent({type:F.AuthSuccess,payload:e}):i.push(ba,e)}(e.payload,this.eventHandlerState)}}))}get eventHandlerState(){return{appInfo:this.appInfo,webauthnAllowed:this.browserFeatures.platform,router:this.router,authState:this.authState,browserFeatures:this.browserFeatures}}checkMagicLink(){const e=window.location.search,t=new URLSearchParams(e);let n=null;return t.has("psg_magic_link")?n=t.get("psg_magic_link"):t.has("psg_verify_link")&&(n=t.get("psg_verify_link")),null!==n&&(this.router.push(ha,{magicLink:n,webauthnAllowed:this.browserFeatures.platform}),!0)}}let j;function $(e,t,n){return l(this,null,(function*(){j=new O(e,t,n),yield j.initializeEventHandler()}))}function z(){return j}function W(e){return l(this,null,(function*(){return null==j?void 0:j.handleEvent(e)}))}function H(){return{initEventHandler:$,getEventHandler:z,emitEvent:W}}const G=s.defineComponent({__name:"Login",props:{canToggleLoginRegister:{type:Boolean},identifier:{},countryCode:{},appInfo:{},visible:{type:Boolean},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},emits:["update:identifier","update:countryCode"],setup(e,{emit:t}){const n=e,{t:a}=s.useLocale(),{passage:i}=s.usePassage(),o=s.ref(""),r=s.computed({get:()=>n.identifier,set(e){t("update:identifier",e)}}),c=s.computed({get:()=>n.countryCode,set(e){t("update:countryCode",e)}}),u=s.ref();s.watch(u,(()=>l(this,null,(function*(){M().onEvent.value(I.onLoaded),m()}))));const p=s.computed((()=>{var e;return null!=(e=n.appInfo.allowed_identifier)?e:s.ce.email}));function f(e){return l(this,null,(function*(){const{identifier:t,identifierExists:i,userStatus:r,userID:l,identifierType:c,emailVerified:u,phoneVerified:p,webauthnTypes:f}=e;if(!M().beforeAuth.value(t))return;const v=function(e,t,i){if(!e){let e=t===d.email?a("email"):a("phone");e=`${e.charAt(0).toUpperCase()}${e.slice(1)}`;let i=`${a("not-recognized",[e])}.`;return n.canToggleLoginRegister&&n.appInfo.public_signup&&(i=`${i} ${a("toggle-register")}`),i}if(e&&i===s.re.INACTIVE)return a("account-no-longer-active");return""}(i,c,r);""===v?H().emitEvent({type:F.LoginUser,payload:{identifier:t,identifierType:c,userID:l,emailVerified:u,phoneVerified:p,webauthnTypes:f}}):o.value=v}))}const v=s.ref(!1);let g;function m(){return l(this,null,(function*(){n.conditionalUI&&(g=new AbortController,i.loginConditional(g.signal).then((e=>{H().emitEvent({type:F.AuthSuccess,payload:{authResult:e}})})).catch((()=>{})))}))}function y(){null==g||g.abort()}return s.onMounted((()=>{const e=localStorage.getItem("psg_last_login");e&&!n.changeEmail&&(r.value=e,v.value=!0)})),s.onBeforeUnmount((()=>{y()})),s.watch((()=>n.visible),(()=>{!0===v.value&&(r.value=""),v.value=!1,n.visible?m():y()})),(e,t)=>(s.openBlock(),s.createBlock(_,{identifierMode:p.value,conditionalUI:e.conditionalUI,showWelcomeBack:v.value,"onUpdate:showWelcomeBack":t[0]||(t[0]=e=>v.value=e),identifier:r.value,"onUpdate:identifier":t[1]||(t[1]=e=>r.value=e),validationError:o.value,"onUpdate:validationError":t[2]||(t[2]=e=>o.value=e),countryCode:c.value,"onUpdate:countryCode":t[3]||(t[3]=e=>c.value=e),onOnSubmit:t[4]||(t[4]=e=>f(e)),ref_key:"inputForm",ref:u},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifierMode","conditionalUI","showWelcomeBack","identifier","validationError","countryCode"]))}}),K={key:0,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"},q=s.defineComponent({__name:"Register",props:{canToggleLoginRegister:{type:Boolean},identifier:{},countryCode:{},appInfo:{}},emits:["update:identifier","update:countryCode","authEvent"],setup(e,{emit:t}){const n=e,{t:a}=s.useLocale(),{passage:i}=s.usePassage(),{emitEvent:o}=H(),r=s.ref(""),u=s.computed({get:()=>n.identifier,set(e){t("update:identifier",e)}}),p=s.computed({get:()=>n.countryCode,set(e){t("update:countryCode",e)}}),f=s.computed((()=>n.appInfo.public_signup)),v=s.computed((()=>n.appInfo.allowed_identifier));const g=s.ref({}),m=s.ref();return(e,t)=>(s.openBlock(),s.createElementBlock("div",null,[s.createVNode(_,{identifierMode:v.value,identifier:u.value,"onUpdate:identifier":t[0]||(t[0]=e=>u.value=e),validationError:r.value,"onUpdate:validationError":t[1]||(t[1]=e=>r.value=e),countryCode:p.value,"onUpdate:countryCode":t[2]||(t[2]=e=>p.value=e),onOnSubmit:t[3]||(t[3]=e=>function(e){return l(this,null,(function*(){const{identifier:t,identifierExists:l,userStatus:u,identifierType:p}=e;if(!M().beforeAuth.value(t))return;let f=!0;if(m.value&&(f=m.value.validate()),l){if(u===s.re.ACTIVE){let e=a("account-already-exists",[p===d.email?a("email"):a("phone-number")]);return n.canToggleLoginRegister&&(e=e+" "+a("toggle-login")),void(r.value=e)}if(u===s.re.INACTIVE)return void(r.value=a("account-no-longer-active"))}if(f){try{yield i.createUser({identifier:t,user_metadata:c.transformMetadata(g.value,n.appInfo.user_metadata_schema,!0)})}catch(v){return void(v instanceof s.h&&v.message.startsWith("Public signup")?r.value=v.message:r.value=a("unexpected-error"))}o({type:F.CreatedUser,payload:{identifier:t,identifierType:p}})}}))}(e))},{metadataFields:s.withCtx((()=>[e.appInfo&&e.appInfo.layouts.registration.length>0?(s.openBlock(),s.createBlock(c.UserMetadata,{key:0,isEditing:!0,appInfo:e.appInfo,layoutType:s.unref(c.LayoutType).Registration,userMetadata:g.value,ref_key:"metadataComponent",ref:m},null,8,["appInfo","layoutType","userMetadata"])):s.createCommentVNode("",!0)])),_:1},8,["identifierMode","identifier","validationError","countryCode"]),f.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",K,s.toDisplayString(s.unref(a)("public-registration-not-allowed")),1))]))}}),Y={key:0,class:"link has-text-centered"},Z={class:"passage-branding"},J={href:"https://passage.1password.com/",target:"_new_tab"},Q=s.defineComponent({__name:"PassageBranding",props:{appInfo:{}},setup:e=>(e,t)=>e.appInfo.passage_branding?(s.openBlock(),s.createElementBlock("div",Y,[s.createBaseVNode("div",Z,[s.createBaseVNode("a",J,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).poweredByPassage,alt:"Powered by Passage Icon"},null,8,["src"])])])])):s.createCommentVNode("",!0)}),X={class:"view-email-input"},ee={class:"auth-flex-container"},te={class:"title main-title has-text-centered"},ne=s.createBaseVNode("div",{style:{height:"20px"}},null,-1),ae=s.createBaseVNode("div",{class:"spacer"},null,-1),ie={class:"link has-text-centered"},oe={key:0},re=["onClick"],le={key:1},se=["onClick"],ce=s.defineComponent({__name:"AuthView",props:{register:{type:Boolean},appInfo:{},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},setup(e){const t=e,{t:n}=s.useLocale(),a=s.ref(!t.register),i=s.ref(""),{defaultCountryCode:o}=s.useDefaultCountryCode(),r=o,l=s.computed((()=>t.appInfo.public_signup));function c(){a.value=!a.value}return(e,t)=>(s.openBlock(),s.createElementBlock("div",X,[s.createBaseVNode("div",ee,[s.createBaseVNode("div",te,s.toDisplayString(a.value?s.unref(n)("login-title"):s.unref(n)("register-title")),1),ne,s.withDirectives(s.createVNode(G,{identifier:i.value,"onUpdate:identifier":t[0]||(t[0]=e=>i.value=e),canToggleLoginRegister:!0,countryCode:s.unref(r),"onUpdate:countryCode":t[1]||(t[1]=e=>s.isRef(r)?r.value=e:null),appInfo:e.appInfo,visible:a.value,conditionalUI:e.conditionalUI,changeEmail:e.changeEmail},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifier","countryCode","appInfo","visible","conditionalUI","changeEmail"]),[[s.vShow,a.value]]),s.withDirectives(s.createVNode(q,{identifier:i.value,"onUpdate:identifier":t[2]||(t[2]=e=>i.value=e),canToggleLoginRegister:!0,countryCode:s.unref(r),"onUpdate:countryCode":t[3]||(t[3]=e=>s.isRef(r)?r.value=e:null),appInfo:e.appInfo},null,8,["identifier","countryCode","appInfo"]),[[s.vShow,!a.value]]),ae,s.createBaseVNode("div",ie,[a.value&&l.value?(s.openBlock(),s.createElementBlock("div",oe,[s.createTextVNode(s.toDisplayString(s.unref(n)("dont-have-an-account"))+" ",1),s.createBaseVNode("a",{onClick:s.withModifiers(c,["prevent"]),role:"button",class:"body-link","data-test":"register-link"},s.toDisplayString(s.unref(n)("register-here")),9,re)])):a.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",le,[s.createTextVNode(s.toDisplayString(s.unref(n)("already-have-an-account"))+" ",1),s.createBaseVNode("a",{onClick:s.withModifiers(c,["prevent"]),role:"button",class:"body-link","data-test":"login-link"},s.toDisplayString(s.unref(n)("login-here")),9,se)]))])]),s.createVNode(Q,{"app-info":e.appInfo},null,8,["app-info"])]))}});var ue=(e=>(e.LOGIN="psg_magic_link",e.VERIFY="psg_verify_link",e))(ue||{});const de=({magicLink:e,uiState:t,magicLinkUtils:n,passage:a})=>{const i=s.ref(null),o=()=>{t.uiLoading(),i.value={auth_token:"",redirect_url:""}},r=()=>{t.uiError()},c=()=>{n.invalidMagicLink.value=!0,t.uiError()},u=e=>l(this,[e],(function*({webauthnAllowed:e,magicLinkAction:n,result:a}){i.value=a,e&&n!==ue.VERIFY||(t.uiSuccess(),yield new Promise((e=>{setTimeout(e,2e3)}))),i.value.redirect_url&&H().emitEvent({type:n===ue.VERIFY?F.AuthSuccess:F.FallbackAuthSuccess,payload:{authResult:a}})}));return{authResult:i,onBeforeActivate:o,onActivateError:r,onActivateErrorInvalidMagicLink:c,onActivateSuccess:u,activateWithoutBiometrics:(t,n)=>l(this,null,(function*(){o();try{const i=yield a.magicLinkActivate(e);u({webauthnAllowed:t,magicLinkAction:n,result:i})}catch(i){i.statusCode===s.P.NotFound?c():r()}}))}},pe={class:"auth-flex-container"},fe={class:"image has-text-centered"},ve={class:"content has-text-centered","data-test":"activate-magic-link-message"},ge={key:0},me={key:1},ye={key:2},he={key:3},ke={key:4},be={key:0,class:"flex-row flex-center",style:{padding:"20px 0px"}},Be=["onClick","disabled"],we={key:0},Ve={key:1},_e={key:2},Ie=s.defineComponent({__name:"ActivateMagicLink",props:{magicLink:{},webauthnAllowed:{type:Boolean}},setup(e){const t=e,{t:n}=s.useLocale(),{passage:a}=s.usePassage(),i=function(){const e=s.ref(!1),t=s.ref(!1),n=s.ref(!1),a=s.ref(!0),{t:i}=s.useLocale(),o=s.computed((()=>t.value?i("success"):e.value?i("something-went-wrong"):i("log-in-with-a-passkey")));return{showFailure:e,showSuccess:t,loading:n,pageLoading:a,title:o,uiSuccess:()=>{t.value=!0,e.value=!1,n.value=!1},uiError:()=>{t.value=!1,e.value=!0,n.value=!1},uiLoading:()=>{t.value=!1,e.value=!1,n.value=!0}}}(),{showFailure:o,showSuccess:r,loading:c,pageLoading:u,title:d}=i,p=(e=>{const t=s.ref(),n=s.ref(!1);return{magicLinkAction:t,invalidMagicLink:n,isMagicLinkValid:()=>{const a=new URLSearchParams(window.location.href.split("?")[1]);return a.has("psg_magic_link")?t.value="psg_magic_link":a.has("psg_verify_link")&&(t.value="psg_verify_link"),t.value&&e||(n.value=!0),!n.value}}})(t.magicLink),{isMagicLinkValid:f,invalidMagicLink:v,magicLinkAction:g}=p,m=de({uiState:i,magicLinkUtils:p,passage:a,magicLink:t.magicLink});function y(){v.value?window.location.href=window.location.href.split("?")[0]:m.activateWithoutBiometrics(t.webauthnAllowed,g.value)}return s.onMounted((()=>l(this,null,(function*(){f()?(yield m.activateWithoutBiometrics(t.webauthnAllowed,g.value),M().onEvent.value(I.onMagicLinkActivateSuccess)):i.uiError(),u.value=!1})))),(e,t)=>(s.openBlock(),s.createBlock(s.Transition,{name:"fade",mode:"out-in",appear:""},{default:s.withCtx((()=>[s.withDirectives(s.createBaseVNode("div",pe,[s.createBaseVNode("div",{class:s.normalizeClass(["title has-text-centered",[s.unref(r)?"main-title":"secondary-title"]])},s.toDisplayString(s.unref(o)?s.unref(v)?s.unref(n)("invalid-link"):s.unref(n)("device-login-failed-title"):s.unref(d)),3),s.createBaseVNode("figure",fe,[s.unref(r)?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).success,alt:"Magic link success"},null,8,["src"])):s.unref(o)?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).failure,alt:"Magic link failure"},null,8,["src"])):s.createCommentVNode("",!0)]),s.createBaseVNode("div",ve,[s.unref(r)&&s.unref(g)===s.unref(ue).LOGIN?(s.openBlock(),s.createElementBlock("div",ge,s.toDisplayString(s.unref(n)("successfully-logged-in-redirect")),1)):s.unref(r)&&s.unref(g)===s.unref(ue).VERIFY?(s.openBlock(),s.createElementBlock("div",me,s.toDisplayString(s.unref(n)("successfully-changed-email")),1)):s.unref(o)&&s.unref(v)&&s.unref(g)===s.unref(ue).VERIFY?(s.openBlock(),s.createElementBlock("div",ye,s.toDisplayString(s.unref(n)("link-invalid")),1)):s.unref(o)&&s.unref(v)?(s.openBlock(),s.createElementBlock("div",he,s.toDisplayString(s.unref(n)("login-link-invalid")),1)):s.unref(o)&&s.unref(g)===s.unref(ue).VERIFY?(s.openBlock(),s.createElementBlock("div",ke,s.toDisplayString(s.unref(n)("verification-failed-please-try-again")),1)):s.createCommentVNode("",!0)]),s.unref(o)||s.unref(r)?(s.openBlock(),s.createElementBlock("div",be,[s.createBaseVNode("button",{onClick:s.withModifiers(y,["prevent"]),type:"button",class:s.normalizeClass(["button is-primary",{"is-loading":s.unref(c)}]),part:"button",disabled:s.unref(c),"data-test":"activate-magic-link-button"},[s.unref(o)&&s.unref(v)?(s.openBlock(),s.createElementBlock("span",we,s.toDisplayString(s.unref(n)("request-new-link")),1)):s.unref(o)?(s.openBlock(),s.createElementBlock("span",Ve,s.toDisplayString(s.unref(n)("try-again")),1)):s.unref(r)?(s.openBlock(),s.createElementBlock("span",_e,s.toDisplayString(s.unref(n)("redirect-now")),1)):s.createCommentVNode("",!0)],10,Be)])):s.createCommentVNode("",!0)],512),[[s.vShow,!s.unref(u)]])])),_:1}))}}),Ce={class:"view-verify-token"},Ne=s.defineComponent({__name:"ActivateMagicLinkView",props:{magicLink:{},webauthnAllowed:{type:Boolean}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Ce,[s.createVNode(Ie,{magicLink:e.magicLink,webauthnAllowed:e.webauthnAllowed},null,8,["magicLink","webauthnAllowed"])]))}),xe={class:"view-email-input"},Se=s.defineComponent({__name:"LoginView",props:{register:{type:Boolean},appInfo:{},conditionalUI:{type:Boolean},changeEmail:{type:Boolean}},setup(e){const t=s.ref(""),{defaultCountryCode:n}=s.useDefaultCountryCode(),a=n;return(e,n)=>(s.openBlock(),s.createElementBlock("div",xe,[s.createVNode(G,{identifier:t.value,"onUpdate:identifier":n[0]||(n[0]=e=>t.value=e),countryCode:s.unref(a),"onUpdate:countryCode":n[1]||(n[1]=e=>s.isRef(a)?a.value=e:null),canToggleLoginRegister:!1,appInfo:e.appInfo,conditionalUI:e.conditionalUI,changeEmail:e.changeEmail},{loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},8,["identifier","countryCode","appInfo","conditionalUI","changeEmail"]),s.createVNode(Q,{"app-info":e.appInfo},null,8,["app-info"])]))}}),Ee={class:"view-email-input"},De=s.defineComponent({__name:"RegisterView",props:{register:{type:Boolean},appInfo:{}},setup(e){const t=s.ref(""),{defaultCountryCode:n}=s.useDefaultCountryCode(),a=n;return(e,n)=>(s.openBlock(),s.createElementBlock("div",Ee,[s.createVNode(q,{identifier:t.value,"onUpdate:identifier":n[0]||(n[0]=e=>t.value=e),countryCode:s.unref(a),"onUpdate:countryCode":n[1]||(n[1]=e=>s.isRef(a)?a.value=e:null),canToggleLoginRegister:!1,appInfo:e.appInfo},null,8,["identifier","countryCode","appInfo"]),s.createVNode(Q,{"app-info":e.appInfo},null,8,["app-info"])]))}}),Te=s.defineComponent({name:"Spinner"}),Le={class:"spinner-box"},Re={class:"spinner-content"};var Me=s._export_sfc(Te,[["render",function(e,t,n,a,i,o){return s.openBlock(),s.createElementBlock("div",Le,[s.createBaseVNode("div",Re,[s.renderSlot(e.$slots,"default")])])}]]);const Ae={class:"auth-flex-container"},Ue={class:"title has-text-centered"},Pe={key:0,class:"content has-text-centered",style:{"margin-bottom":"15px !important"}},Fe=["innerHTML"],Oe={class:"flex-row flex-center"},je=["onClick","disabled"],$e=s.createBaseVNode("div",{class:"spacer"},null,-1),ze={class:"link has-text-centered"},We=["onClick"],He=s.defineComponent({__name:"MagicLink",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup(e){const t=e,{t:n,locale:a}=s.useLocale(),{passage:i}=s.usePassage(),{emitEvent:o}=H(),r=s.computed((()=>t.identifierType===d.email)),c=s.computed((()=>t.identifierVerifying?r.value?t.userIsRegistering?n("verify-email-to-register"):n("verify-email-to-login"):t.userIsRegistering?n("verify-phone-to-register"):n("verify-phone-to-login"):r.value?t.userIsRegistering?n("check-email-to-register"):n("check-email-to-login"):t.userIsRegistering?n("check-phone-to-register"):n("check-phone-to-login"))),u=s.computed((()=>{let e="";const a=t.identifierType===d.email?n("messagetype-email"):n("messagetype-sms"),i=t.identifierType===d.email?n("email"):n("phone-number"),o=t.userIsRegistering?n("registration"):n("login"),r=t.identifierVerifying?n("please-verify-identifier",[i,o]):n("you-will-be-automatically-signed-in");return e=n("weve-sent-messagetype",[a,t.identifier,r]),t.setupNewDevice&&!t.userIsRegistering&&(e=n("we-dont-recognize-this-device")+" "+e),e}));function p(){localStorage.removeItem("email"),localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),b(721),o({type:F.ChangeIdentifier,payload:void 0})}function f(){return l(this,null,(function*(){yield m()}))}s.onMounted((()=>{t.userIsRegistering?function(){l(this,null,(function*(){v.value=!1,g.value=!0,yield new Promise((e=>{setTimeout(e,2e3)}));try{const e=yield i.newRegisterMagicLink(t.identifier,a.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{g.value=!1}}))}():m()}));const v=s.ref(!1),g=s.ref(!0);function m(){return l(this,null,(function*(){v.value=!1,g.value=!0;try{const e=yield i.newLoginMagicLink(t.identifier,a.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{yield new Promise((e=>{setTimeout(e,3e3)})),g.value=!1}}))}let y,h;function k(){return l(this,null,(function*(){const e=localStorage.getItem("magic_link_id");yield function(e){return l(this,null,(function*(){yield i.getMagicLinkStatus(e).then((e=>{b(721),y=e})).catch((()=>{}))}))}(e).then((()=>l(this,null,(function*(){y&&""!=y.redirect_url&&(localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),M().onEvent.value(I.onMagicLinkActivated),o({type:F.FallbackAuthSuccess,payload:{identifier:t.identifier,authResult:y}}))}))))}))}function b(e){let t=e;if(!(t<720))return clearTimeout(h),void(v.value=!1);v.value=!0,h=setTimeout((()=>l(this,null,(function*(){!function(e){k(),localStorage.setItem("wait_count",e.toString())}(t),t++,b(t)}))),5e3)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",Ae,[s.createBaseVNode("div",Ue,[s.createBaseVNode("span",null,s.toDisplayString(c.value),1)]),s.createVNode(Me,null,{default:s.withCtx((()=>[r.value?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).email,alt:"Email envelope"},null,8,["src"])):(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).phone,alt:"Message bubbles"},null,8,["src"]))])),_:1}),u.value?(s.openBlock(),s.createElementBlock("div",Pe,[s.createBaseVNode("span",{innerHTML:u.value},null,8,Fe)])):s.createCommentVNode("",!0),s.createBaseVNode("div",Oe,[s.createBaseVNode("button",{onClick:s.withModifiers(f,["prevent"]),type:"button",class:"button is-primary",part:"button",disabled:g.value},s.toDisplayString(s.unref(n)("resend-isemail-email-message",[r.value?s.unref(n)("email"):s.unref(n)("message")])),9,je)]),$e,s.createBaseVNode("div",ze,[s.createBaseVNode("a",{onClick:s.withModifiers(p,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(n)("change-isemail-email-phone",[r.value?s.unref(n)("email"):s.unref(n)("phone")])),9,We)])]))}}),Ge={class:"view-access-token"},Ke=s.defineComponent({__name:"MagicLinkView",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Ge,[s.createVNode(He,{identifier:e.identifier,userIsRegistering:e.userIsRegistering,identifierVerifying:e.identifierVerifying,setupNewDevice:e.setupNewDevice,identifierType:e.identifierType},null,8,["identifier","userIsRegistering","identifierVerifying","setupNewDevice","identifierType"])]))}),qe={class:"passage-learnmore-modal"},Ye={class:"passage-learnmore-top"},Ze={class:"passage-learnmore-close-button"},Je={class:"passage-learnmore-content"},Qe={style:{"margin-bottom":"32px"}},Xe=s.defineComponent({__name:"LearnMoreLayout",setup(e){const{t:t}=s.useLocale(),n=s.ref(!1);return(e,a)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[n.value?(s.openBlock(),s.createElementBlock("div",{key:0,class:"passage-learnmore",onClick:a[1]||(a[1]=e=>n.value=!1)},[s.createBaseVNode("div",qe,[s.createBaseVNode("div",Ye,[s.createBaseVNode("div",{style:{cursor:"pointer"},onClick:a[0]||(a[0]=e=>n.value=!1)},[s.createBaseVNode("span",Ze,s.toDisplayString(s.unref(t)("close")),1),s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).close},null,8,["src"])])]),s.createBaseVNode("div",Je,[s.renderSlot(e.$slots,"body")])])])):s.createCommentVNode("",!0),s.createBaseVNode("div",null,[s.createBaseVNode("div",Qe,[s.createBaseVNode("span",null,[s.renderSlot(e.$slots,"cta"),s.createTextVNode("   ")]),s.createBaseVNode("a",{style:{"text-decoration":"underline"},onClick:a[2]||(a[2]=e=>n.value=!0),role:"button"},s.toDisplayString(s.unref(t)("learn-more")),1),s.createTextVNode(" → ")])])],64))}}),et={style:{"margin-bottom":"12px"}},tt={class:"passage-learnmore-header"},nt={class:"passage-learnmore-body"},at={class:"passage-learnmore-header"},it={class:"passage-learnmore-body"},ot={class:"passage-learnmore-header"},rt={class:"passage-learnmore-body"},lt=s.defineComponent({__name:"LearnMorePasskey",props:{cta:{}},setup(e){const{t:t}=s.useLocale();return(e,n)=>(s.openBlock(),s.createBlock(Xe,null,{cta:s.withCtx((()=>[s.createBaseVNode("div",et,s.toDisplayString(s.unref(t)("passkeys-are-a-simple")),1),s.createTextVNode(" "+s.toDisplayString(e.cta),1)])),body:s.withCtx((()=>[s.createBaseVNode("div",tt,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).privateIcon,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("private")),1)]),s.createBaseVNode("div",nt,s.toDisplayString(s.unref(t)("unlock-your-passkey")),1),s.createBaseVNode("div",at,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).secure,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("secure")),1)]),s.createBaseVNode("div",it,s.toDisplayString(s.unref(t)("passkey-is-unique")),1),s.createBaseVNode("div",ot,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).simple,style:{"margin-right":"8px"}},null,8,["src"]),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("simple")),1)]),s.createBaseVNode("div",rt,s.toDisplayString(s.unref(t)("easy-to-use")),1)])),_:1}))}}),st={class:"auth-flex-container","data-tag":"register-device-message"},ct={class:"title secondary-title has-text-centered"},ut={class:"image has-text-centered"},dt={key:0},pt={key:1},ft={key:1},vt={style:{"margin-bottom":"12px"}},gt={style:{"margin-bottom":"22px"}},mt={key:2},yt={style:{"margin-bottom":"32px"}},ht={key:2,class:"flex-row flex-center"},kt=["onClick","disabled"],bt=["onClick","disabled"],Bt={key:3,class:"flex-column flex-center",style:{margin:"auto"}},wt=["onClick","disabled"],Vt=["onClick","disabled"],_t=s.createBaseVNode("div",{class:"spacer"},null,-1),It={key:4,class:"content has-text-centered",style:{"margin-top":"20px !important"}},Ct={class:"link"},Nt=["onClick"],xt={class:"link"},St=["onClick"],Et={key:0,class:"link"},Dt=["onClick"],Tt=s.defineComponent({__name:"RegisterDevice",props:{identifier:{},identifierType:{},appInfo:{},browserFeatures:{}},setup(e){const t=e,n=s.ref(!1),a=s.ref(!1),{t:i,te:o}=s.useLocale(),{passage:r}=s.usePassage(),{emitEvent:c}=H(),{autofocusButton:u}=p(),f=s.computed((()=>t.browserFeatures.platform)),v=s.computed((()=>t.browserFeatures.securityKey)),g=s.computed((()=>t.identifierType===d.email)),m=s.computed((()=>{var e;return null!=(e=t.appInfo.auth_fallback_method)?e:s.he.MagicLink})),y=s.computed((()=>t.appInfo.auth_fallback_method!==s.he.None)),h=s.computed((()=>m.value===s.he.LoginCode?o("register-with-code")?i("register-with-code"):"Register with a code":i("register-with-link",[g.value?i("email"):i("sms-text")]))),k=s.computed((()=>m.value===s.he.LoginCode?o("send-code")?i("send-code"):"Send code":i("send-email-or-text-link",[g.value?i("email"):i("sms-text")]))),b=s.computed((()=>{switch(t.appInfo.auth_fallback_method){case s.he.LoginCode:return o("passkey-create-fail-try-code")?i("passkey-create-fail-try-code"):"Unable to create a passkey. Try again or register with a one-time code.";case s.he.MagicLink:return i("passkey-create-fail-try-link");case s.he.None:return i("passkey-create-fail-no-fallback")}}));let B=s.E.Platform;function w(e,i){return l(this,null,(function*(){a.value=!0;try{B=i;const n=yield r.register(e,{authenticatorAttachment:i});a.value=!1,c({type:F.AuthSuccess,payload:{authResult:n,identifier:t.identifier}})}catch(o){n.value=!0,a.value=!1}}))}function V(){c({type:F.FallbackAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userIsRegistering:!0,userInitiated:!0}})}function _(){localStorage.removeItem("email"),H().emitEvent({type:F.ChangeIdentifier,payload:void 0})}function I(){!0===f.value?w(t.identifier,s.E.Platform):w(t.identifier,s.E.CrossPlatform)}function C(){w(t.identifier,s.E.CrossPlatform)}function N(){w(t.identifier,B)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",st,[s.createBaseVNode("div",ct,s.toDisplayString(f.value?s.unref(i)("register-with-a-passkey"):s.unref(i)("register-passkey-another-device")),1),s.createBaseVNode("figure",ut,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkey,alt:"Register with a passkey"},null,8,["src"])]),n.value?(s.openBlock(),s.createElementBlock("div",dt,[s.createBaseVNode("p",null,s.toDisplayString(b.value),1)])):(s.openBlock(),s.createElementBlock("div",pt,[f.value&&!v.value?(s.openBlock(),s.createBlock(lt,{key:0,cta:s.unref(i)("register-your-account")},null,8,["cta"])):s.createCommentVNode("",!0),f.value&&v.value?(s.openBlock(),s.createElementBlock("div",ft,[s.createBaseVNode("div",vt,s.toDisplayString(s.unref(i)("passkeys-are-a-simple")),1),s.createBaseVNode("div",gt,s.toDisplayString(s.unref(i)("passkey-register-options")),1)])):s.createCommentVNode("",!0),!f.value&&v.value?(s.openBlock(),s.createElementBlock("div",mt,[s.createBaseVNode("div",yt,s.toDisplayString(s.unref(i)("passkeys-not-supported-try-another-device")),1)])):s.createCommentVNode("",!0)])),n.value?(s.openBlock(),s.createElementBlock("div",ht,[s.createBaseVNode("button",{onClick:s.withModifiers(N,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:a.value,style:{"margin-right":"5px"}},s.toDisplayString(s.unref(i)("try-again")),9,kt),e.appInfo.auth_fallback_method!==s.unref(s.he).None?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(V,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:a.value,style:{"margin-left":"5px"},"data-test":"login-with-email-button",ref_key:"autofocusButton",ref:u},s.toDisplayString(k.value),9,bt)):s.createCommentVNode("",!0)])):(s.openBlock(),s.createElementBlock("div",Bt,[s.createBaseVNode("button",{onClick:s.withModifiers(I,["prevent"]),type:"button",class:s.normalizeClass(["button",[{"is-loading":a.value}]]),part:"button",disabled:a.value,"data-test":"register-main-button",tabindex:"0",ref_key:"autofocusButton",ref:u,style:{"margin-top":"0px"}},[s.createBaseVNode("span",null,s.toDisplayString(f.value?s.unref(i)("register-with-passkey"):s.unref(i)("use-another-device")),1)],10,wt),f.value&&v.value?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(C,["prevent"]),type:"button",class:s.normalizeClass(["button is-secondary",[{"is-loading":a.value}]]),part:"button button-secondary",style:{width:"100%"},disabled:a.value,"data-test":"register-secondary-button",tabindex:"0",ref_key:"autofocusButton",ref:u},[s.createBaseVNode("span",null,s.toDisplayString(s.unref(i)("use-another-device")),1)],10,Vt)):s.createCommentVNode("",!0)])),_t,n.value?(s.openBlock(),s.createElementBlock("div",It,[s.createBaseVNode("div",Ct,[s.createBaseVNode("a",{onClick:s.withModifiers(_,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(i)("change-isemail-email-phone",[g.value?s.unref(i)("email"):s.unref(i)("phone")])),9,Nt)])])):s.createCommentVNode("",!0),n.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:5,class:s.normalizeClass(["flex-row flex-wrap",y.value?"flex-between":"flex-center"])},[s.createBaseVNode("div",xt,[s.createBaseVNode("a",{onClick:s.withModifiers(_,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(i)("back")),9,St)]),y.value?(s.openBlock(),s.createElementBlock("div",Et,[s.createBaseVNode("a",{onClick:s.withModifiers(V,["prevent"]),role:"button","data-test":"register-email-button"},s.toDisplayString(h.value),9,Dt)])):s.createCommentVNode("",!0)],2))]))}}),Lt=s.defineComponent({__name:"RegisterDeviceView",props:{identifier:{},identifierType:{},appInfo:{},browserFeatures:{}},setup(e){const t=e;return(e,n)=>(s.openBlock(),s.createBlock(Tt,s.normalizeProps(s.guardReactiveProps(t)),null,16))}}),Rt={class:"auth-flex-container"},Mt={class:"title has-text-centered"},At={class:"image has-text-centered",style:{margin:"5px auto"}},Ut={key:1,class:"wrap-text",style:{"margin-bottom":"5px !important"}},Pt={"data-test":"failure-message"},Ft={key:2,class:"flex-row flex-center"},Ot=["onClick","disabled"],jt=["onClick","disabled"],$t=s.createBaseVNode("div",{class:"spacer"},null,-1),zt={key:3,class:"content has-text-centered",style:{"margin-top":"20px !important"}},Wt={class:"link"},Ht=["onClick"],Gt={class:"link"},Kt=["onClick"],qt={key:0,class:"link"},Yt=["onClick"],Zt=s.defineComponent({__name:"WebauthnSignIn",props:{identifier:{},identifierType:{},appInfo:{}},setup(e){const t=e,n=s.ref(!1),a=s.ref(!1),{t:i,te:o}=s.useLocale(),{passage:r}=s.usePassage(),{emitEvent:c}=H(),u=s.computed((()=>t.identifierType===d.email)),{autofocusButton:f}=p(),v=s.computed((()=>{var e;return null!=(e=t.appInfo.auth_fallback_method)?e:s.he.MagicLink})),g=s.computed((()=>t.appInfo.auth_fallback_method!==s.he.None)),m=s.computed((()=>v.value===s.he.LoginCode?o("send-code")?i("send-code"):"Send code":i("send-email-or-text-link",[u.value?i("email"):i("sms-text")]))),y=s.computed((()=>v.value===s.he.LoginCode?o("login-with-code")?i("login-with-code"):"Login with a code":i("login-with-link",[u.value?i("email"):i("sms-text")]))),h=s.computed((()=>{switch(t.appInfo.auth_fallback_method){case s.he.LoginCode:return o("passkey-login-fail-try-code")?i("passkey-login-fail-try-code"):"Unable to log in with a passkey. Try again or log in with a one-time code.";case s.he.MagicLink:return i("passkey-login-fail-try-link");case s.he.None:return i("passkey-login-fail-no-fallback")}}));function k(){return l(this,null,(function*(){if(n.value=!1,t.identifier){a.value=!0;try{const e=yield r.login(t.identifier);c({type:F.AuthSuccess,payload:{authResult:e,identifier:t.identifier}}),a.value=!1}catch(e){const i=e;n.value=!0,a.value=!1,i.statusCode===s.P.PSGParsePublicKeyForLoginFailed?n.value=!0:c({type:F.FallbackAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userInitiated:!1}})}}}))}function b(){c({type:F.FallbackAuth,payload:{identifier:t.identifier,identifierType:t.identifierType,userInitiated:!0}})}function B(){localStorage.removeItem("email"),c({type:F.ChangeIdentifier,payload:void 0})}return s.onMounted((()=>{k()})),(e,t)=>(s.openBlock(),s.createElementBlock("div",Rt,[s.createBaseVNode("div",Mt,s.toDisplayString(s.unref(i)("log-in-with-a-passkey")),1),s.createBaseVNode("figure",At,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkey,alt:"Log in with a passkey",style:{margin:"5px"}},null,8,["src"])]),n.value?n.value?(s.openBlock(),s.createElementBlock("div",Ut,[s.createBaseVNode("div",Pt,[s.createBaseVNode("p",null,s.toDisplayString(h.value),1)])])):s.createCommentVNode("",!0):(s.openBlock(),s.createBlock(lt,{key:0,cta:s.unref(i)("log-into-your-account")},null,8,["cta"])),n.value?(s.openBlock(),s.createElementBlock("div",Ft,[s.createBaseVNode("button",{onClick:s.withModifiers(k,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:a.value,style:{"margin-right":"5px"}},s.toDisplayString(s.unref(i)("try-again")),9,Ot),e.appInfo.auth_fallback_method!==s.unref(s.he).None?(s.openBlock(),s.createElementBlock("button",{key:0,onClick:s.withModifiers(b,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:a.value,style:{"margin-left":"5px"},"data-test":"login-with-email-button",ref_key:"autofocusButton",ref:f},s.toDisplayString(m.value),9,jt)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0),$t,n.value?(s.openBlock(),s.createElementBlock("div",zt,[s.createBaseVNode("div",Wt,[s.createBaseVNode("a",{onClick:s.withModifiers(B,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(i)("change-isemail-email-phone",[u.value?s.unref(i)("email"):s.unref(i)("phone")])),9,Ht)])])):s.createCommentVNode("",!0),n.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:4,class:s.normalizeClass(["flex-row flex-wrap",g.value?"flex-between":"flex-center"])},[s.createBaseVNode("div",Gt,[s.createBaseVNode("a",{onClick:s.withModifiers(B,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(i)("back")),9,Kt)]),g.value?(s.openBlock(),s.createElementBlock("div",qt,[s.createBaseVNode("a",{onClick:s.withModifiers(b,["prevent"]),role:"button","data-test":"register-email-button"},s.toDisplayString(y.value),9,Yt)])):s.createCommentVNode("",!0)],2))]))}}),Jt={class:"view-webauthn-sign-in"},Qt=s.defineComponent({__name:"WebauthnSignInView",props:{identifier:{},identifierType:{},appInfo:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Jt,[s.createVNode(Zt,{identifier:e.identifier,identifierType:e.identifierType,appInfo:e.appInfo},null,8,["identifier","identifierType","appInfo"])]))}),Xt={style:{display:"flex","align-items":"center"},class:"psg-otp-single-input-container"},en=["data-test","type","inputtype","placeholder","inputmode","disabled","maxlength","autocomplete"],tn={key:0},nn=["innerHTML"],an=s.defineComponent({__name:"OneTimePasscodeSingleInput",props:{conditionalClass:{},focus:{type:Boolean},inputClasses:{default:()=>[]},inputmode:{default:"numeric"},inputType:{default:"number"},isDisabled:{type:Boolean},isLastChild:{type:Boolean},placeholder:{},separator:{default:""},shouldAutoFocus:{type:Boolean,default:!1},value:{default:""},isFirstChild:{type:Boolean},inputIdx:{},inputCount:{}},emits:["on-change","on-keydown","on-paste","on-focus","on-blur"],setup(e,{emit:t}){const n=e,a=s.ref(n.value||""),i=s.ref(null),o=s.computed((()=>"letter-numeric"===n.inputType?"text":n.inputType)),r=()=>(a.value=a.value.toString(),a.value.length>1&&(a.value=a.value.slice(0,1)),t("on-change",a.value)),l=e=>{n.isDisabled&&e.preventDefault();const a=e||window.event,i=a.which?a.which:a.keyCode;(e=>e>=48&&e<=57||e>=96&&e<=105)(i)||"letter-numeric"===n.inputType&&(e=>e>=65&&e<=90)(i)||[8,9,13,37,39,46,86].includes(i)?t("on-keydown",e):a.preventDefault()},c=e=>t("on-paste",e),u=()=>(i.value.select(),t("on-focus")),d=()=>t("on-blur");return s.watch((()=>n.value),((e,t)=>{e!==t&&(a.value=e)})),s.watch((()=>n.focus),((e,t)=>{t!==e&&i.value&&n.focus&&(i.value.focus(),i.value.select())})),s.onMounted((()=>{i.value&&n.focus&&n.shouldAutoFocus&&(i.value.focus(),i.value.select())})),(e,t)=>(s.openBlock(),s.createElementBlock("div",Xt,[s.withDirectives(s.createBaseVNode("input",{"data-test":`otp-single-input-${e.inputIdx}`,type:o.value,inputtype:o.value,placeholder:e.placeholder,inputmode:e.inputmode,disabled:e.isDisabled,ref_key:"input",ref:i,pattern:"[0-9]*",maxlength:e.isFirstChild?e.inputCount:1,min:"0",max:"9","onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),class:s.normalizeClass(["psg-input","psg-otp-input",[...e.inputClasses||[]]]),onInput:r,onKeydown:l,onPaste:c,onFocus:u,onBlur:d,autocomplete:e.isFirstChild?"one-time-code":"off"},null,42,en),[[s.vModelDynamic,a.value]]),!e.isLastChild&&e.separator?(s.openBlock(),s.createElementBlock("span",tn,[s.createBaseVNode("span",{innerHTML:e.separator},null,8,nn)])):s.createCommentVNode("",!0)]))}}),on={style:{display:"flex","justify-content":"space-between"},class:"psg-otp-input-container"},rn={key:0,autocomplete:"off",name:"hidden",type:"text",style:{display:"none"}},ln=s.defineComponent({__name:"OneTimePasscodeInput",props:{value:{default:""},numInputs:{default:6},separator:{default:""},inputClasses:{},conditionalClass:{default:()=>[]},inputType:{default:"number"},inputmode:{default:"numeric"},shouldAutoFocus:{type:Boolean,default:!1},placeholder:{default:()=>[]},isDisabled:{type:Boolean,default:!1},disableNonCurrent:{type:Boolean,default:!1}},emits:["update:value","on-complete","on-change"],setup(e,{emit:t}){const n=e,a=s.ref(0),i=s.ref([]),o=s.ref([]);s.watch((()=>n.value),(e=>{const t=(s.unref(e)||"").padEnd(n.numInputs," ").split("");i.value=t}),{immediate:!0});const r=()=>{a.value=-1},l=e=>{a.value=Math.max(Math.min(n.numInputs-1,e),0)},c=()=>{n.disableNonCurrent?setTimeout((()=>{l(a.value+1)}),200):l(a.value+1)},u=()=>{l(a.value-1)},d=e=>{o.value=Object.assign([],i.value),i.value[a.value]=e,o.value.join("")!==i.value.join("")&&(t("update:value",i.value.join("")),t("on-change",i.value.join("")))},p=e=>{var o;e.preventDefault();const r=null==(o=e.clipboardData)?void 0:o.getData("text/plain").slice(0,n.numInputs-a.value).split("");if("number"===n.inputType&&!(null==r?void 0:r.join("").match(/^\d+$/)))return"Invalid pasted data";if("letter-numeric"===n.inputType&&!(null==r?void 0:r.join("").match(/^\w+$/)))return"Invalid pasted data";const s=i.value.slice(0,a.value).concat(r||"");return s.slice(0,n.numInputs).forEach(((e,t)=>{i.value[t]=e})),l(s.slice(0,n.numInputs).length),i.value.join("").length===n.numInputs?(t("update:value",i.value.join("")),t("on-complete",i.value.join(""))):"Wait until the user enters the required number of characters"},f=e=>{d(e),c()},v=e=>{switch(e.keyCode){case 8:e.preventDefault(),d(""),u();break;case 46:e.preventDefault(),d("");break;case 37:e.preventDefault(),u();break;case 39:e.preventDefault(),c()}};return(e,t)=>(s.openBlock(),s.createElementBlock("div",on,["password"===e.inputType?(s.openBlock(),s.createElementBlock("input",rn)):s.createCommentVNode("",!0),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(e.numInputs,((t,n)=>(s.openBlock(),s.createBlock(an,{key:n,focus:a.value===n,value:i.value[n],separator:e.separator,"input-type":e.inputType,inputmode:e.inputmode,"input-classes":e.inputClasses,conditionalClass:e.conditionalClass[n],"is-last-child":n===e.numInputs-1,"is-first-child":0===n,"should-auto-focus":e.shouldAutoFocus,placeholder:e.placeholder[n],"is-disabled":e.isDisabled||e.disableNonCurrent&&n>i.value.join("").trim().length,"input-idx":n,"input-count":e.numInputs,onOnChange:f,onOnKeydown:v,onOnPaste:p,onOnFocus:e=>{return t=n,void(a.value=t);var t},onOnBlur:r},null,8,["focus","value","separator","input-type","inputmode","input-classes","conditionalClass","is-last-child","is-first-child","should-auto-focus","placeholder","is-disabled","input-idx","input-count","onOnFocus"])))),128))]))}}),sn={class:"auth-flex-container"},cn={class:"flex flex-column",style:{"flex-grow":"1"}},un={class:"title has-text-centered"},dn={class:"content wrap-text"},pn={style:{"margin-top":"32px","margin-bottom":"40px"}},fn=["innerHTML"],vn={class:"flex flex-row flex-center"},gn={class:"flex-row",style:{"margin-top":"8px"}},mn={class:"error-message",style:{"min-height":"17px"}},yn={class:"flex-row flex-center",style:{"margin-top":"16px"}},hn=["onClick","disabled"],kn=s.createBaseVNode("div",{class:"spacer"},null,-1),bn={class:"flex-row flex-wrap flex-between"},Bn={class:"link"},wn=["onClick"],Vn={class:"link"},_n=["onClick"],In=s.defineComponent({__name:"OneTimePasscode",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup(e){const t=e,{t:n,te:a,locale:i}=s.useLocale(),o=s.ref(!0),r=s.ref(void 0),c=s.ref(!1),u=s.ref(!1),d=s.ref(void 0),p=s.ref(void 0),f=s.computed((()=>a("enter-code")?n("enter-code",{}):"Enter code")),v=s.computed((()=>a("enter-code-sent")?n("enter-code-sent",[t.identifier]):`A one-time code has been sent to <span style="font-weight: 700;">${t.identifier}</span>. Enter the code here to log in.`)),g=s.computed((()=>a("back")?n("back"):"Back")),m=s.computed((()=>a("resend-code")?n("resend-code"):"Resend code")),y=s.computed((()=>c.value?["has-error"]:[])),h=s.computed((()=>false)),k=s.computed((()=>o.value));s.watch(r,(()=>{var e;x(),6===(null==(e=r.value)?void 0:e.trim().length)&&w()}));const{passage:b}=s.usePassage(),B=(e=!1)=>l(this,null,(function*(){N(),x(),S(),o.value=!0;try{const n=e?yield b.newRegisterOneTimePasscode(t.identifier,i.value.split("-")[0]):yield b.newLoginOneTimePasscode(t.identifier,i.value.split("-")[0]);""!=n.otp_id&&(localStorage.setItem("otp_id",n.otp_id),p.value=n.otp_id)}catch(r){E(a("code-send-error")?n("code-send-error"):"An error occurred sending the code.",!0)}finally{o.value=!1}})),w=()=>l(this,null,(function*(){N(),x(),o.value=!0;try{if(!r.value)throw new Error("Login code is undefined.");if(6!==r.value.length)throw new Error("Login code is invalid length.");if(!p.value)throw new Error("Login code id is undefined.");const e=yield b.oneTimePasscodeActivate(r.value,p.value);e&&""!=e.redirect_url&&(localStorage.removeItem("otp_id"),M().onEvent.value(I.onOneTimePasscodeActivated),H().emitEvent({type:F.FallbackAuthSuccess,payload:{identifier:t.identifier,authResult:e}}))}catch(e){E(a("code-invalid-or-expired")?n("code-invalid-or-expired"):"Code is invalid or expired. Please try again.")}finally{o.value=!1}})),V=()=>{H().emitEvent({type:F.ChangeIdentifier,payload:void 0})},_=()=>{B()},C=()=>{w()};s.onMounted((()=>{B(t.userIsRegistering),function(){const e=D.value.getRootNode().host;D.value.appendChild(function(){const e=document.createElement("style");return e.appendChild(document.createTextNode("\n      .psg-otp-input-container{\n        margin: 0px;\n        padding: 0px;\n        align-items: center;\n        height: auto;\n        width: auto;\n      }\n      .psg-otp-single-input-container{\n        margin: 0px;\n        padding: 0px;\n        height: auto;\n        width: auto;\n      }\n      .psg-otp-input {\n        width: 40px;\n        height: 40px;\n        padding: 0px;\n        margin-left: 4px;\n        margin-right: 4px;\n        font-size: 24px;\n        font-weight: 400;\n        color: var(--passage-input-text-color, var(--passage-body-text-color-default));\n        font-family: var(--passage-body-font-family, var(--passage-body-font-family-default));\n        line-height: 29px;\n        border-radius: 4px;\n        border: 1px solid transparent;\n        text-align: center;\n        background-color: var(--passage-otp-input-background-color, var(--passage-otp-input-background-color-default));\n        -moz-appearance: textfield;\n      }\n      .psg-otp-input:read-only {\n        background-color: var(--passage-otp-input-background-color, var(--passage-otp-input-background-color-default));\n      }\n      .psg-otp-input::-webkit-inner-spin-button{\n        -webkit-appearance: none;\n        display: none;\n        margin: 0;\n      }\n      .psg-otp-input::-webkit-outer-spin-button{\n        -webkit-appearance: none;\n        display: none;\n        margin: 0;\n      }\n      .psg-input.has-error{\n        border-color: var(--passage-error-color, var(--passage-error-color-default)) !important;\n      }\n      .psg-input.is-danger {\n        border-color: var(--passage-error-color, var(--passage-error-color-default)) !important;\n      }\n      .psg-input:focus {\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }\n      .psg-input:active {\n        outline: none;\n        box-shadow: none !important;\n        border-color: var(--passage-control-border-active-color, var(--passage-control-border-active-color-default));\n      }")),e}()),e.appendChild(D.value)}()})),s.onBeforeUnmount((()=>{D.value.remove()}));const N=()=>{o.value=!0},x=()=>{d.value=void 0,c.value=!1,u.value=!1},S=()=>{r.value=void 0},E=(e,t=!1)=>{d.value=e,c.value=!t,u.value=t},D=s.ref();return(e,t)=>(s.openBlock(),s.createElementBlock("div",sn,[s.createBaseVNode("form",cn,[s.createBaseVNode("div",un,[s.createBaseVNode("span",null,s.toDisplayString(f.value),1)]),s.createBaseVNode("div",dn,[s.createBaseVNode("div",pn,[s.createBaseVNode("p",{innerHTML:v.value},null,8,fn)])]),s.createBaseVNode("div",vn,[s.createBaseVNode("div",{ref_key:"otpInput",ref:D,slot:"otpInput"},[s.createVNode(ln,{"num-inputs":6,"is-disabled":h.value,value:r.value,"onUpdate:value":t[0]||(t[0]=e=>r.value=e),"input-classes":y.value,"disable-non-current":!1},null,8,["is-disabled","value","input-classes"])],512),s.renderSlot(e.$slots,"otpInput")]),s.createBaseVNode("div",gn,[s.createBaseVNode("div",mn,s.toDisplayString(d.value?d.value:" "),1)]),s.createBaseVNode("div",yn,[s.createBaseVNode("button",{type:"submit",class:"button is-primary",part:"button","data-test":"continue-button",onClick:s.withModifiers(C,["prevent"]),disabled:k.value},s.toDisplayString(s.unref(n)("continue")),9,hn)]),kn,s.createBaseVNode("div",bn,[s.createBaseVNode("div",Bn,[s.createBaseVNode("a",{onClick:s.withModifiers(V,["prevent"]),role:"button","data-test":"one-time-passcode-goback-button"},s.toDisplayString(g.value),9,wn)]),s.createBaseVNode("div",Vn,[s.createBaseVNode("a",{onClick:s.withModifiers(_,["prevent"]),role:"button","data-test":"one-time-passcode-resend-button"},s.toDisplayString(m.value),9,_n)])])])]))}}),Cn={class:"view-access-token"},Nn=s.defineComponent({__name:"OneTimePasscodeView",props:{identifier:{},userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Cn,[s.createVNode(In,{identifier:e.identifier,userIsRegistering:e.userIsRegistering,identifierVerifying:e.identifierVerifying,setupNewDevice:e.setupNewDevice,identifierType:e.identifierType},{otpInput:s.withCtx((()=>[s.renderSlot(e.$slots,"otpInput")])),_:3},8,["identifier","userIsRegistering","identifierVerifying","setupNewDevice","identifierType"])]))}),xn={class:"title has-text-centered secondary-title","data-test":"activate-magic-link-message"},Sn={class:"image has-text-centered"},En={key:0},Dn={class:"flex-row flex-center",style:{padding:"20px 0px"}},Tn=["onClick","disabled"],Ln={key:0},Rn={key:1},Mn={key:2,class:"link has-text-centered"},An=["onClick"],Un=s.defineComponent({__name:"AddDevice",props:{authResult:{},identifier:{}},setup(e){const t=e,{t:n}=s.useLocale(),a=s.ref(!1),i=s.ref(!1),o=s.ref(),{addDevice:r,addPending:c}=s.useAddDevice(),{autofocusButton:u}=p(),d=s.computed((()=>a.value?n("something-went-wrong"):n("add-passkey")));function f(){return l(this,null,(function*(){var e;o.value=yield r(),(null==(e=o.value)?void 0:e.id)?(i.value=!0,a.value=!1,v()):(a.value=!0,i.value=!1)}))}const v=()=>{H().emitEvent({type:F.AuthSuccess,payload:{identifier:t.identifier,authResult:t.authResult}})};return(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createBaseVNode("div",xn,s.toDisplayString(d.value),1),s.createBaseVNode("figure",Sn,[a.value?(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:0,src:s.unref(s.Icons).fingerprintFailed,alt:"Device failure"},null,8,["src"])):(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{key:1,src:s.unref(s.Icons).passkey,alt:"Add a passkey",style:{margin:"5px"}},null,8,["src"]))]),a.value?(s.openBlock(),s.createElementBlock("div",En,s.toDisplayString(s.unref(n)("failed-to-add-this-device")),1)):(s.openBlock(),s.createBlock(lt,{key:1,cta:s.unref(n)("log-into-your-account")},null,8,["cta"])),s.createBaseVNode("div",Dn,[s.createBaseVNode("button",{onClick:s.withModifiers(f,["prevent"]),type:"button",class:s.normalizeClass(["button is-primary",{"is-loading":s.unref(c)}]),part:"button",disabled:s.unref(c),"data-test":"save-device-button",ref_key:"autofocusButton",ref:u},[a.value?(s.openBlock(),s.createElementBlock("span",Ln,s.toDisplayString(s.unref(n)("try-again")),1)):(s.openBlock(),s.createElementBlock("span",Rn,s.toDisplayString(s.unref(n)("add-passkey")),1))],10,Tn)]),i.value?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",Mn,[s.createBaseVNode("div",null,[s.createBaseVNode("a",{onClick:s.withModifiers(v,["prevent"]),role:"button","data-test":"add-device-skip"},s.toDisplayString(s.unref(n)("skip")),9,An)])]))],64))}}),Pn={class:"view-add-device"},Fn=s.defineComponent({__name:"AddDeviceView",props:{authResult:{},identifier:{}},setup:e=>(e,t)=>(s.openBlock(),s.createElementBlock("div",Pn,[s.createVNode(Un,{authResult:e.authResult,identifier:e.identifier},null,8,["authResult","identifier"])]))}),On={class:"wrap-text",style:{"margin-bottom":"12px !important"}},jn={class:"passage-learnmore-header"},$n={class:"passage-learnmore-body"},zn={class:"passage-learnmore-header"},Wn={class:"passage-learnmore-body"},Hn=s.defineComponent({__name:"LearnMoreDisabledFallbacks",setup(e){const{t:t}=s.useLocale();return(e,n)=>(s.openBlock(),s.createBlock(Xe,null,{cta:s.withCtx((()=>[s.createBaseVNode("div",On,s.toDisplayString(s.unref(t)("passkeys-are-required"))+s.toDisplayString(" "),1),s.createTextVNode(" "+s.toDisplayString(s.unref(t)("try-again-on-device-with-passkeys")),1)])),body:s.withCtx((()=>[s.createBaseVNode("div",jn,s.toDisplayString(s.unref(t)("what-are-passkeys")),1),s.createBaseVNode("div",$n,s.toDisplayString(s.unref(t)("passkeys-are-a-simpler-and-more-secure-alternative")),1),s.createBaseVNode("div",zn,s.toDisplayString(s.unref(t)("devices-that-support-passkeys")),1),s.createBaseVNode("div",Wn,s.toDisplayString(s.unref(t)("devices-with-a-biometric-sensor-are-likely-to-support-passkeys")),1)])),_:1}))}}),Gn={class:"auth-flex-container"},Kn={class:"title has-text-centered"},qn={class:"image has-text-centered",style:{margin:"5px auto"}},Yn=s.createBaseVNode("div",{class:"spacer"},null,-1),Zn={class:"flex-row flex-wrap flex-center"},Jn={class:"link"},Qn=["onClick"],Xn=s.defineComponent({__name:"DisableFallbacks",setup(e){const{t:t}=s.useLocale(),{emitEvent:n}=H();function a(){localStorage.removeItem("email"),n({type:F.ChangeIdentifier,payload:void 0})}return(e,n)=>(s.openBlock(),s.createElementBlock("div",Gn,[s.createBaseVNode("div",Kn,s.toDisplayString(s.unref(t)("device-not-supported")),1),s.createBaseVNode("figure",qn,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkeyArrow,alt:"Device not supported",style:{margin:"5px"}},null,8,["src"])]),s.createVNode(Hn),Yn,s.createBaseVNode("div",Zn,[s.createBaseVNode("div",Jn,[s.createBaseVNode("a",{onClick:s.withModifiers(a,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(t)("back")),9,Qn)])])]))}}),ea=s.defineComponent({__name:"DisableFallbackView",setup:e=>(e,t)=>(s.openBlock(),s.createBlock(Xn))}),ta={class:"auth-flex-container"},na={class:"title has-text-centered"},aa={class:"image has-text-centered",style:{margin:"5px auto"}},ia={class:"wrap-text",style:{"margin-bottom":"12px !important"}},oa={class:"wrap-text"},ra=s.createBaseVNode("div",{class:"spacer"},null,-1),la={class:"flex-row flex-wrap flex-center"},sa={class:"link"},ca=["onClick"],ua=s.defineComponent({__name:"LoginNotSupported",setup(e){const{t:t}=s.useLocale(),{emitEvent:n}=H();function a(){localStorage.removeItem("email"),n({type:F.ChangeIdentifier,payload:void 0})}return(e,n)=>(s.openBlock(),s.createElementBlock("div",ta,[s.createBaseVNode("div",na,s.toDisplayString(s.unref(t)("login-not-supported")),1),s.createBaseVNode("figure",aa,[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).passkeyArrow,alt:"Device not supported",style:{margin:"5px"}},null,8,["src"])]),s.createBaseVNode("div",ia,s.toDisplayString(s.unref(t)("passkeys-are-now-required")),1),s.createBaseVNode("div",oa,s.toDisplayString(s.unref(t)("please-contact-support-to-regain-access")),1),ra,s.createBaseVNode("div",la,[s.createBaseVNode("div",sa,[s.createBaseVNode("a",{onClick:s.withModifiers(a,["prevent"]),role:"button","data-test":"change-email-button"},s.toDisplayString(s.unref(t)("back")),9,ca)])])]))}}),da=s.defineComponent({__name:"LoginNotSupportedView",setup:e=>(e,t)=>(s.openBlock(),s.createBlock(ua))}),pa={component:ce},fa={component:Se},va={component:De},ga={component:Lt},ma={component:Ke},ya={component:Qt},ha={component:Ne},ka={component:Nn},ba={component:Fn},Ba={component:ea},wa={component:da},Va={passage_container_background_color:"--passage-container-background-color-default",passage_container_max_width:"--passage-container-max-width-default",passage_input_box_background_color:"--passage-input-box-background-color-default",passage_input_box_border_radius:"--passage-input-box-border-radius-default",passage_header_font_family:"--passage-header-font-family-default",passage_body_font_family:"--passage-body-font-family-default",passage_header_text_color:"--passage-header-text-color-default",passage_body_text_color:"--passage-body-text-color-default",passage_primary_button_background_color:"--passage-primary-button-background-color-default",passage_primary_button_text_color:"--passage-primary-button-text-color-default",passage_primary_button_hover_color:"--passage-primary-button-background-hover-color-default",passage_primary_button_border_radius:"--passage-primary-button-border-radius-default",passage_primary_button_border_color:"--passage-primary-button-border-color-default",passage_primary_button_border_width:"--passage-primary-button-border-width-default",passage_secondary_button_background_color:"--passage-secondary-button-background-color-default",passage_secondary_button_text_color:"-passage-secondary-button-text-color-default",passage_secondary_button_hover_color:"--passage-secondary-button-background-hover-color-default",passage_secondary_button_border_radius:"--passage-secondary-button-border-radius-default",passage_secondary_button_border_color:"--passage-secondary-button-border-color-default",passage_secondary_button_border_width:"--passage-secondary-button-border-width-default"},_a={passage_container_max_width:"passage_container_max_width",passage_input_box_border_radius:"passage_input_box_border_radius",passage_primary_button_border_radius:"passage_primary_button_border_radius",passage_primary_button_border_width:"passage_primary_button_border_width",passage_secondary_button_border_radius:"passage_secondary_button_border_radius",passage_secondary_button_border_width:"passage_secondary_button_border_width"};class Ia{constructor(e){this._homeRoute=pa,this._history=[],void 0!==e&&(this._homeRoute=e)}get homeRoute(){return this._homeRoute}set homeRoute(e){this._homeRoute=e}get currentRoute(){if(0!==this._history.length)return this._history[this._history.length-1]}push(e,l){var s;this._history.push((s=((e,t)=>{for(var n in t||(t={}))i.call(t,n)&&r(e,n,t[n]);if(a)for(var n of a(t))o.call(t,n)&&r(e,n,t[n]);return e})({},e),t(s,n({props:l}))))}resetRouter(){this._history=[]}}const Ca={class:"debug-router"},Na=s.createBaseVNode("div",{class:"section-label"},"View",-1),xa=s.createBaseVNode("div",{class:"section-label"},"Props",-1),Sa={key:0},Ea=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),Da=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Ta={key:1},La=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),Ra=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Ma={key:2},Aa=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),Ua=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Pa=s.createBaseVNode("div",{class:"control-label"},"Setup New Device",-1),Fa=s.createBaseVNode("div",{class:"control-label"},"User Is Registering",-1),Oa=s.createBaseVNode("div",{class:"control-label"},"Verifying Identifier",-1),ja={key:3},$a=s.createBaseVNode("div",{class:"control-label"},"Identifier",-1),za=s.createBaseVNode("div",{class:"control-label"},"Identifier Type",-1),Wa=s.createBaseVNode("div",{class:"control-label"},"Setup New Device",-1),Ha=s.createBaseVNode("div",{class:"control-label"},"User Is Registering",-1),Ga=s.createBaseVNode("div",{class:"control-label"},"Verifying Identifier",-1),Ka={key:4},qa=s.createBaseVNode("div",{class:"control-label"},"Magic Link",-1),Ya={key:5},Za=["onClick"],Ja="authenticator@passage.id",Qa=(s.defineComponent({__name:"DebugRouter",props:{router:{},appInfo:{}},setup(e){const t=e,n=s.ref([{name:"Main View",value:{route:t.router.homeRoute,key:"MAINVIEW"}},{name:"Register Device",value:{route:ga,key:"REGISTERDEVICE"}},{name:"Webauthnn Login",value:{route:ya,key:"WEBAUTHNSIGNIN"}},{name:"One Time Passcode",value:{route:ka,key:"OTP"}},{name:"Maigc Link",value:{route:ma,key:"MAGICLINK"}},{name:"Activate Magic Link",value:{route:ha,key:"ACTIVATEMAGICLINK"}},{name:"Add Device",value:{route:ba,key:"ADDDEVICE"}},{name:"Device Not Supported",value:{route:Ba,key:"DEVICENOTSUPPORTED"}},{name:"Login Not Supported",value:{route:wa,key:"LOGINNOTSUPPORTED"}}]),a=s.ref(n.value[0].value),{passage:i}=s.usePassage();i.getCredentialAvailable().then((e=>l.browserFeatures=e)),i.getCurrentSession().getAuthToken().then((e=>{g.authResult.auth_token=e})).catch((()=>{}));const o=[{name:"Email",value:d.email},{name:"Phone",value:d.phone}],r=s.reactive({register:!1,appInfo:t.appInfo}),l=s.reactive({identifier:Ja,identifierType:d.email,appInfo:t.appInfo,browserFeatures:{securityKey:!0,platform:!0,syncedCredential:!0,crossDeviceCredential:!0,conditionalUI:!0,isAvailable:!0}}),u=s.reactive({identifier:Ja,identifierType:d.email,appInfo:t.appInfo}),p=s.reactive({identifier:Ja,identifierType:d.email,setupNewDevice:!1,userIsRegistering:!1,identifierVerifying:!1}),f=s.reactive({identifier:Ja,identifierType:d.email,setupNewDevice:!1,userIsRegistering:!1,identifierVerifying:!1}),v=s.reactive({magicLink:"",webauthnAllowed:!0}),g=s.reactive({authResult:{redirect_url:t.appInfo.redirect_url,auth_token:""}});function m(){let e;switch(a.value.key){case"MAINVIEW":e=r;break;case"REGISTERDEVICE":e=l;break;case"WEBAUTHNSIGNIN":e=u;break;case"OTP":e=p;break;case"MAGICLINK":e=f;break;case"ACTIVATEMAGICLINK":e=v;break;case"ADDDEVICE":e=g;break;case"DEVICENOTSUPPORTED":case"LOGINNOTSUPPORTED":e=void 0}t.router.push(a.value.route,e)}return(e,t)=>(s.openBlock(),s.createElementBlock("div",Ca,[Na,s.createVNode(s.Dropdown,{modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),items:n.value},null,8,["modelValue","items"]),xa,"REGISTERDEVICE"===a.value.key?(s.openBlock(),s.createElementBlock("div",Sa,[Ea,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,l.identifier]]),Da,s.createVNode(s.Dropdown,{modelValue:l.identifierType,"onUpdate:modelValue":t[2]||(t[2]=e=>l.identifierType=e),items:o},null,8,["modelValue"])])):"WEBAUTHNSIGNIN"===a.value.key?(s.openBlock(),s.createElementBlock("div",Ta,[La,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>u.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,u.identifier]]),Ra,s.createVNode(s.Dropdown,{modelValue:u.identifierType,"onUpdate:modelValue":t[4]||(t[4]=e=>u.identifierType=e),items:o},null,8,["modelValue"])])):"OTP"===a.value.key?(s.openBlock(),s.createElementBlock("div",Ma,[Aa,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>p.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,p.identifier]]),Ua,s.createVNode(s.Dropdown,{modelValue:p.identifierType,"onUpdate:modelValue":t[6]||(t[6]=e=>p.identifierType=e),items:o},null,8,["modelValue"]),Pa,s.createVNode(c.Checkbox,{modelValue:p.setupNewDevice,"onUpdate:modelValue":t[7]||(t[7]=e=>p.setupNewDevice=e)},null,8,["modelValue"]),Fa,s.createVNode(c.Checkbox,{modelValue:p.userIsRegistering,"onUpdate:modelValue":t[8]||(t[8]=e=>p.userIsRegistering=e)},null,8,["modelValue"]),Oa,s.createVNode(c.Checkbox,{modelValue:p.identifierVerifying,"onUpdate:modelValue":t[9]||(t[9]=e=>p.identifierVerifying=e)},null,8,["modelValue"])])):"MAGICLINK"===a.value.key?(s.openBlock(),s.createElementBlock("div",ja,[$a,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[10]||(t[10]=e=>f.identifier=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,f.identifier]]),za,s.createVNode(s.Dropdown,{modelValue:f.identifierType,"onUpdate:modelValue":t[11]||(t[11]=e=>f.identifierType=e),items:o},null,8,["modelValue"]),Wa,s.createVNode(c.Checkbox,{modelValue:f.setupNewDevice,"onUpdate:modelValue":t[12]||(t[12]=e=>f.setupNewDevice=e)},null,8,["modelValue"]),Ha,s.createVNode(c.Checkbox,{modelValue:f.userIsRegistering,"onUpdate:modelValue":t[13]||(t[13]=e=>f.userIsRegistering=e)},null,8,["modelValue"]),Ga,s.createVNode(c.Checkbox,{modelValue:f.identifierVerifying,"onUpdate:modelValue":t[14]||(t[14]=e=>f.identifierVerifying=e)},null,8,["modelValue"])])):"ACTIVATEMAGICLINK"===a.value.key?(s.openBlock(),s.createElementBlock("div",Ka,[qa,s.withDirectives(s.createBaseVNode("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>v.magicLink=e),type:"text",class:"input psg-input"},null,512),[[s.vModelText,v.magicLink]])])):(s.openBlock(),s.createElementBlock("div",Ya,"None")),s.createBaseVNode("button",{class:"button",onClick:s.withModifiers(m,["prevent"])},"Go To View",8,Za)]))}}),s.defineComponent({__name:"DebugPanel",props:{router:{},appInfo:{}},setup(e){s.ref(),s.ref(!1);return(e,t)=>s.createCommentVNode("",!0)}})),Xa={key:1,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"},ei=s.defineComponent({__name:"SmartRouter",props:{homeRoute:{},authContainerRef:{}},setup(e){const t=e,n=s.reactive(new Ia(t.homeRoute)),a=s.computed((()=>n.currentRoute)),{t:i}=s.useLocale(),{appInfo:o,loading:r,invalidAppId:c,passage:u}=s.useAppInfo(),{initEventHandler:d}=H(),{setCustomElementStyles:p}={setCustomElementStyles:(e,t)=>{Object.entries(t).forEach((t=>{const[n,a]=t;let i=a;Object.values(_a).includes(n)&&(i=function(e){return`${e}px`}(a)),e.style.setProperty(Va[n],i)}))}},f=s.computed((()=>{var e;return null==(e=a.value)?void 0:e.component})),v=s.computed((()=>{var e;const t=null==(e=a.value)?void 0:e.props;return void 0===t?{}:t})),g=s.ref(!1);return s.watch(o,(()=>l(this,null,(function*(){g.value=!1,void 0!==o.value&&void 0!==u.value&&(yield d(o.value,n,u.value),g.value=!0,t.authContainerRef&&p(t.authContainerRef,o.value.element_customization))})))),(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createVNode(s.Transition,{name:"fade",mode:"out-in",appear:""},{default:s.withCtx((()=>[!s.unref(r)&&g.value?(s.openBlock(),s.createBlock(s.resolveDynamicComponent(f.value),s.normalizeProps(s.mergeProps({key:0},v.value)),{otpInput:s.withCtx((()=>[s.renderSlot(e.$slots,"otpInput")])),loginInput:s.withCtx((()=>[s.renderSlot(e.$slots,"loginInput")])),_:3},16)):s.createCommentVNode("",!0)])),_:3}),s.unref(o)&&g.value?(s.openBlock(),s.createBlock(Qa,{key:0,router:n,"app-info":s.unref(o)},null,8,["router","app-info"])):s.createCommentVNode("",!0),s.unref(c)?(s.openBlock(),s.createElementBlock("div",Xa,s.toDisplayString(s.unref(i)("invalid-app-id")),1)):s.createCommentVNode("",!0)],64))}});exports.AuthRoute=pa,exports.LoginRoute=fa,exports.RegisterRoute=va,exports._sfc_main=ei,exports.useElementSetup=function(e){function t(){e.appId&&s.createPassageInstance(e.appId,e.tokenStore);const{updateDefaultCountryCode:t}=s.useDefaultCountryCode();t(e.defaultCountryCode);const{setBeforeAuth:n,setOnSuccess:a,setOnEvent:i}=M();n(e.beforeAuth),a(e.onSuccess),i(e.onEvent)}t(),s.onBeforeUpdate((()=>{t()}));const{languageLoading:n}=s.useStoreLocale(e),a=s.ref();return s.useIntlTelInput(a),{languageLoading:n,containerRef:a}};
//# 
