"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,i=(e,t,n)=>new Promise(((o,a)=>{var r=e=>{try{i(n.next(e))}catch(t){a(t)}},l=e=>{try{i(n.throw(e))}catch(t){a(t)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,l);i((n=n.apply(e,t)).next())}));Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var s=require("../customElements.js"),c=require("../useProfileElementSetup.js"),u=require("../socialConnectionMetadata.js");const d=s.defineComponent({name:"Metadata Section",components:{UserMetadata:u.UserMetadata},props:{appInfo:{type:Object,required:!0},userInfo:{type:Object,required:!1},refreshMetadata:{type:Function,required:!0}},setup(e){const{t:t}=s.useLocale(),n=s.ref(!1),{updateMetadata:o,updateMetadataError:a}=u.useUpdateUser();const r=s.ref();return{LayoutType:u.LayoutType,isEditing:n,save:function(){return i(this,null,(function*(){var t;let a=!0;if(r.value){if(!r.value.validate())return;(null==(t=e.userInfo)?void 0:t.user_metadata)&&(a=yield o(e.userInfo.user_metadata,e.appInfo.user_metadata_schema))}n.value=!a}))},cancel:function(){return i(this,null,(function*(){yield e.refreshMetadata(),r.value&&r.value.validate(),n.value=!1}))},componentRef:r,updateMetadataError:a,t:t}}}),p={class:"metadata-header"},f={class:"title secondary-title"},m={key:0,class:"edit-save-container"},v={key:0},g={key:1,style:{"text-align":"center"}},y={class:"title secondary-title"};var k=s._export_sfc(d,[["render",function(e,t,n,o,a,r){var l;const i=s.resolveComponent("user-metadata");return s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createBaseVNode("div",p,[s.createBaseVNode("div",f,s.toDisplayString(e.t("personal-info")),1),e.userInfo&&e.appInfo.profile_management?(s.openBlock(),s.createElementBlock("div",m,[e.isEditing?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:0,class:"edit-save-text",onClick:t[0]||(t[0]=s.withModifiers((t=>e.isEditing=!0),["prevent"]))},s.toDisplayString(e.t("edit")),1)),e.isEditing?(s.openBlock(),s.createElementBlock("div",{key:1,class:"edit-save-text",onClick:t[1]||(t[1]=s.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"]))},s.toDisplayString(e.t("save")),1)):s.createCommentVNode("",!0),e.isEditing?(s.openBlock(),s.createElementBlock("div",{key:2,class:"edit-save-text",onClick:t[2]||(t[2]=s.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"]))},s.toDisplayString(e.t("cancel")),1)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0)]),s.createBaseVNode("div",{class:s.normalizeClass(["feedback",e.updateMetadataError?"feedback-danger":""])},[e.updateMetadataError?(s.openBlock(),s.createElementBlock("div",v,s.toDisplayString(e.updateMetadataError),1)):s.createCommentVNode("",!0)],2),e.userInfo?(s.openBlock(),s.createBlock(i,{key:0,appInfo:e.appInfo,layoutType:e.LayoutType.Profile,userMetadata:null!=(l=e.userInfo.user_metadata)?l:{},ref:"componentRef",isEditing:e.isEditing},null,8,["appInfo","layoutType","userMetadata","isEditing"])):(s.openBlock(),s.createElementBlock("div",g,[s.createBaseVNode("div",y,s.toDisplayString(e.t("no-user-found")),1),s.createBaseVNode("div",null,s.toDisplayString(e.t("there-is-no-currently-logged-in-user")),1)]))],64)}]]);const B=s.defineComponent({name:"Editable Control",props:{title:{type:String,required:!0},editable:{type:Boolean,default:!0},onSave:{type:Function,required:!1},onCancel:{type:Function,required:!1},isEditing:{type:Boolean,default:void 0},errorMessage:{type:String,required:!1}},emits:["update:isEditing","editStart"],setup(e,t){const{t:n}=s.useLocale(),o=s.ref(!1),a=s.computed({get:()=>void 0===e.isEditing?o.value:e.isEditing,set(n){void 0!==e.isEditing?(t.emit("update:isEditing",n),n&&t.emit("editStart")):o.value=n}});const r=s.ref(),l=s.ref(!1);const i=new ResizeObserver((()=>{!function(){if(void 0===r.value)return;const e=r.value.getBoundingClientRect().width;l.value=e<415}()}));return s.onMounted((()=>{r.value&&i.observe(r.value)})),s.onBeforeUnmount((()=>{i.disconnect()})),{isEditingValue:a,save:function(){void 0!==e.onSave?e.onSave().then((e=>{e&&(a.value=!1)})):a.value=!1},cancel:function(){void 0!==e.onCancel?e.onCancel().then((()=>{a.value=!1})):a.value=!1},container:r,isCompact:l,t:n}}}),E={class:"user-info-label"},h={class:"login-info-control"},b={key:0,class:"edit-save-container"},C={class:"message is-danger"},I={key:0};var N=s._export_sfc(B,[["render",function(e,t,n,o,a,r){return s.openBlock(),s.createElementBlock("form",{onSubmit:t[3]||(t[3]=s.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"])),onKeyup:t[4]||(t[4]=s.withKeys(((...t)=>e.cancel&&e.cancel(...t)),["esc"]))},[s.createBaseVNode("div",{class:s.normalizeClass(["login-info-row",{isCompact:e.isCompact}]),ref:"container"},[s.createBaseVNode("div",E,s.toDisplayString(e.title),1),s.createBaseVNode("div",h,[s.renderSlot(e.$slots,"default")]),e.editable?(s.openBlock(),s.createElementBlock("div",b,[e.isEditing?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",{key:0,class:"edit-save-text",onClick:t[0]||(t[0]=s.withModifiers((t=>e.isEditingValue=!0),["prevent"])),"data-test":"edit-button"},s.toDisplayString(e.t("edit")),1)),e.isEditing?(s.openBlock(),s.createElementBlock("div",{key:1,class:"edit-save-text",onClick:t[1]||(t[1]=s.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"])),"data-test":"save-button"},s.toDisplayString(e.t("save")),1)):s.createCommentVNode("",!0),e.isEditing?(s.openBlock(),s.createElementBlock("div",{key:2,class:"edit-save-text",onClick:t[2]||(t[2]=s.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"])),"data-test":"cancel-button"},s.toDisplayString(e.t("cancel")),1)):s.createCommentVNode("",!0)])):s.createCommentVNode("",!0),s.createBaseVNode("div",C,[e.errorMessage?(s.openBlock(),s.createElementBlock("div",I,s.toDisplayString(e.errorMessage),1)):s.createCommentVNode("",!0)])],2)],32)}]]);const V=s.defineComponent({name:"Phone Number",components:{EditableControl:N},props:{userInfo:{type:Object,required:!1},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(e,t){var n;const{t:o}=s.useLocale(),a=s.ref(!1),{changePhoneRequest:r,updateInfoMessage:l,updatePhoneError:c,updatePending:d,identifierExists:p}=u.useUpdateUser(),f=s.computed((()=>{const e=o("phone-number");return e.charAt(0).toUpperCase()+e.slice(1)}));let m;(m||(m={})).NONE="N/A";const v=s.ref((null==(n=e.userInfo)?void 0:n.phone)||m.NONE);let g=v.value,y="";const k=s.ref(),B=s.ref(),{defaultCountryCode:E}=s.useDefaultCountryCode();let h;function b(){v.value.trim()||(v.value="N/A")}return s.watch(k,(()=>{var e;h=u.intlTelInput(k.value,{initialCountry:null!=(e=null==h?void 0:h.getSelectedCountryData().iso2)?e:E.value,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:B.value,autoPlaceholder:"aggressive"})})),{isEditing:a,phone:v,controlContainer:B,phoneInputBox:k,cancel:function(){return i(this,null,(function*(){c.value="",v.value=g,h&&(h.setCountry(y),v.value=v.value.replace(`+${null==h?void 0:h.getSelectedCountryData().dialCode}`,""))}))},save:function(){return i(this,null,(function*(){var n,a,s,u;const f=null!=(a=null==(n=e.userInfo)?void 0:n.phone)?a:"",m="N/A"===v.value?"":v.value;return c.value="",!e.required||null!=(s=null==h?void 0:h.getNumber())&&s?f===(null!=(u=null==h?void 0:h.getNumber())?u:"")?(b(),!0):(yield function(e,n){return i(this,null,(function*(){if(h){const a=null==h?void 0:h.getNumber();if(a&&!(null==h?void 0:h.isValidNumber()))return c.value=o("invalid-phone"),!1;if(n===a)return!1;if(a){const e=yield p(a).catch((()=>{c.value=o("something-went-wrong"),d.value=!1}));if(c.value)return!1;if(!e)return c.value=o("phone-number-already-in-use"),!1}if(n!==a)return yield r(a),""===c.value&&(t.emit("globalMessage",l.value),g=e,!0)}return!1}))}(m,f),!c.value&&(b(),!0)):(c.value=o("phone-number-is-required"),!1)}))},onEdit:function(){h&&(y=h.getSelectedCountryData().iso2),"N/A"===v.value?v.value="":v.value=v.value.replace(`+${null==h?void 0:h.getSelectedCountryData().dialCode}`,"")},updatePhoneError:c,updatePending:d,title:f,t:o}}}),w=["readonly"],_={ref:"controlContainer",style:{width:"100%"}};var M=s._export_sfc(V,[["render",function(e,t,n,o,a,r){const l=s.resolveComponent("loading"),i=s.resolveComponent("editable-control");return s.openBlock(),s.createElementBlock(s.Fragment,null,[e.updatePending?(s.openBlock(),s.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):s.createCommentVNode("",!0),s.createVNode(i,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":t[2]||(t[2]=t=>e.isEditing=t),errorMessage:e.updatePhoneError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:s.withCtx((()=>[s.withDirectives(s.createBaseVNode("input",{type:"text",id:"phone",class:s.normalizeClass(["input short",{"is-danger":e.updatePhoneError}]),part:"input","onUpdate:modelValue":t[0]||(t[0]=t=>e.phone=t),readonly:!e.isEditing,onInput:t[1]||(t[1]=t=>e.updatePhoneError=""),ref:"phoneInputBox",inputmode:"tel",autocomplete:"tel","data-test":"profile-phone-input"},null,42,w),[[s.vModelText,e.phone]]),s.createBaseVNode("div",_,null,512)])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const S=s.defineComponent({name:"Phone Number",components:{EditableControl:N},props:{userInfo:{type:Object,required:!1},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(e,t){var n;const{t:o}=s.useLocale(),a=s.ref(!1),{changeEmailRequest:r,updateInfoMessage:l,updateEmailError:c,updatePending:d,identifierExists:p}=u.useUpdateUser(),f=s.computed((()=>{const e=o("email");return e.charAt(0).toUpperCase()+e.slice(1)}));let m;(m||(m={})).NONE="N/A";const v=s.ref((null==(n=e.userInfo)?void 0:n.email)||m.NONE);let g=v.value;function y(){v.value.trim()||(v.value="N/A")}return{isEditing:a,email:v,cancel:function(){return i(this,null,(function*(){c.value="",v.value=g}))},save:function(){return i(this,null,(function*(){var n,a;const s=null!=(a=null==(n=e.userInfo)?void 0:n.email)?a:"",f="N/A"===v.value?"":v.value;return c.value="",e.required&&!f.trim()?(c.value=o("email-is-required"),!1):s===f.trim()?(y(),!0):(yield function(e,n){return i(this,null,(function*(){if(n!==e){const n=e.trim().toLowerCase();if(n&&!u.isEmail(v.value))return c.value=o("invalid-email"),!1;if(n){const e=yield p(n).catch((()=>{c.value=o("something-went-wrong"),d.value=!1}));if(c.value)return!1;if(!e)return c.value=o("email-address-already-in-use"),!1}if(yield r(n),""===c.value)return t.emit("globalMessage",l.value),g=e,!0}return!1}))}(f,s),!c.value&&(y(),!0))}))},onEdit:function(){"N/A"===v.value&&(v.value="")},updateEmailError:c,updatePending:d,title:f}}}),q=["readonly"];var P=s._export_sfc(S,[["render",function(e,t,n,o,a,r){const l=s.resolveComponent("loading"),i=s.resolveComponent("editable-control");return s.openBlock(),s.createElementBlock(s.Fragment,null,[e.updatePending?(s.openBlock(),s.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):s.createCommentVNode("",!0),s.createVNode(i,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":t[2]||(t[2]=t=>e.isEditing=t),errorMessage:e.updateEmailError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:s.withCtx((()=>[s.withDirectives(s.createBaseVNode("input",{type:"text",class:s.normalizeClass(["input short",{"is-danger":e.updateEmailError}]),part:"input",readonly:!e.isEditing,"onUpdate:modelValue":t[0]||(t[0]=t=>e.email=t),onInput:t[1]||(t[1]=t=>e.updateEmailError=""),inputmode:"email",autocomplete:"email","data-test":"profile-email-input"},null,42,q),[[s.vModelText,e.email]])])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const x=s.defineComponent({name:"UserInfo",components:{PhoneNumber:M,Email:P},props:{userInfo:{type:Object,required:!1},appInfo:{type:Object,required:!0}},setup(e){const{t:t}=s.useLocale(),n=s.ref("");const o=s.computed((()=>e.appInfo.allowed_identifier!==s.ue.phone)),a=s.computed((()=>e.appInfo.allowed_identifier!==s.ue.email)),r=s.computed((()=>e.appInfo.required_identifier===s.le.Email||e.appInfo.required_identifier===s.le.Both)),l=s.computed((()=>e.appInfo.required_identifier===s.le.Phone||e.appInfo.required_identifier===s.le.Both));return{message:n,globalMessage:function(e){n.value=e},showEmail:o,showPhone:a,emailRequired:r,phoneRequired:l,t:t}}}),D={class:"title secondary-title"},O={key:0};var j=s._export_sfc(x,[["render",function(e,t,n,o,a,r){const l=s.resolveComponent("email"),i=s.resolveComponent("phone-number");return s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createBaseVNode("div",D,s.toDisplayString(e.t("login-info")),1),s.createBaseVNode("div",{class:s.normalizeClass(["feedback",e.message?"feedback-info":""])},[e.message?(s.openBlock(),s.createElementBlock("div",O,s.toDisplayString(e.message),1)):s.createCommentVNode("",!0)],2),e.showEmail?(s.openBlock(),s.createBlock(l,{key:0,userInfo:e.userInfo,required:e.emailRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["userInfo","required","editable","onGlobalMessage"])):s.createCommentVNode("",!0),e.showPhone?(s.openBlock(),s.createBlock(i,{key:1,userInfo:e.userInfo,required:e.phoneRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["userInfo","required","editable","onGlobalMessage"])):s.createCommentVNode("",!0)],64)}]]);const A={class:"flex-row flex-end",style:{"margin-bottom":"30px"}},U={class:"title secondary-title"},R=s.createBaseVNode("div",{class:"spacer"},null,-1),T={class:"flex-row",style:{"align-items":"center"}},L={key:0,class:"profile-table-icon-wrapper social"},z={class:"profile-table-info"},F={class:"social-label"},$={class:"social-connection"},G={class:"social-identifier"},K={class:"profile-table-metadata"},W=["data-test"],H=s.defineComponent({__name:"SocialConnectionsTable",props:{userInfo:{}},setup(e){const i=e,{t:d}=s.useLocale(),{theme:p}=s.useTheme(),f=s.ref(),m=s.computed((()=>void 0===i.userInfo?[]:Object.keys(i.userInfo.social_connections).map((e=>{var c;const d=u.socialConnectionMetadata[e];return f=((e,t)=>{for(var n in t||(t={}))a.call(t,n)&&l(e,n,t[n]);if(o)for(var n of o(t))r.call(t,n)&&l(e,n,t[n]);return e})({},(null==(c=i.userInfo)?void 0:c.social_connections)[e]),m={nameKey:d.nameKey,icon:p.value===s.Theme.Dark?d.icons.dark:d.icons.light},t(f,n(m));var f,m})))),v=s.ref(!1);return(e,t)=>(s.openBlock(),s.createElementBlock("div",{class:"table-container",ref_key:"tableContainerRef",ref:f},[v.value?(s.openBlock(),s.createBlock(c._sfc_main,{key:0,active:v.value},null,8,["active"])):s.createCommentVNode("",!0),s.createBaseVNode("div",A,[s.createBaseVNode("div",U,s.toDisplayString(s.unref(d)("my-social-connections")),1),R]),(s.openBlock(),s.createBlock(c._sfc_main$1,{class:"passage-profile-table",dataset:m.value,columns:["friendly_name"],isIconActionMenu:!1,key:m.value.length},{friendly_name:s.withCtx((({item:e,index:t,isMobile:n,formatDateTime:o})=>[s.createBaseVNode("div",T,[n?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",L,[s.createVNode(s.unref(s.InlineSvg),{class:"profile-table-icon",src:e.icon,alt:"Social connection icon"},null,8,["src"])])),s.createBaseVNode("div",{class:s.normalizeClass(["profile-table-content social",{isMobile:n}])},[s.createBaseVNode("div",z,[s.createBaseVNode("div",F,[s.createBaseVNode("div",$,[s.createBaseVNode("strong",null,s.toDisplayString(s.unref(d)(e.nameKey)),1)]),s.createBaseVNode("div",G,s.toDisplayString(e.provider_identifier),1)]),s.createBaseVNode("div",K,[s.createBaseVNode("span",{"data-test":`passkey-table-row-${t}-device-date-added`},s.toDisplayString(`${s.unref(d)("added-time")}: ${o(e.created_at)}`),9,W)])])],2)])])),_:1},8,["dataset"]))],512))}}),J={key:1,class:"notification is-danger has-text-centered"},Q={key:3,class:"profile-divider"},X={key:5,class:"profile-divider"},Y={key:7,class:"profile-divider"},Z=s.defineComponent({__name:"ProfileView",props:{appInfo:{},webauthnAllowed:{type:Boolean},passkeysEnabled:{type:Boolean}},setup(e){const t=e,{userInfo:n,loading:o,error:a,refreshDevices:r,refreshMetadata:l}=c.useCurrentUser(t.appInfo),i=s.computed((()=>{var e,o;const a=Object.keys(t.appInfo.social_connections).length>0,r=Object.keys(null!=(o=null==(e=n.value)?void 0:e.social_connections)?o:{}).length>0;return a&&r}));return(e,t)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.unref(o)?(s.openBlock(),s.createBlock(c._sfc_main,{key:0,active:s.unref(o)},null,8,["active"])):s.unref(a)&&s.unref(a).statusCode!==s.unref(s.b).PSGLoginRequired?(s.openBlock(),s.createElementBlock("div",J," Unable to get information about current user: "+s.toDisplayString(s.unref(a).statusText),1)):s.createCommentVNode("",!0),s.unref(o)?s.createCommentVNode("",!0):(s.openBlock(),s.createBlock(j,{key:2,userInfo:s.unref(n),appInfo:e.appInfo},null,8,["userInfo","appInfo"])),e.appInfo.layouts.profile.length>0?(s.openBlock(),s.createElementBlock("div",Q)):s.createCommentVNode("",!0),!s.unref(o)&&e.appInfo.layouts.profile.length>0?(s.openBlock(),s.createBlock(k,{key:4,appInfo:e.appInfo,userInfo:s.unref(n),refreshMetadata:s.unref(l)},null,8,["appInfo","userInfo","refreshMetadata"])):s.createCommentVNode("",!0),i.value?(s.openBlock(),s.createElementBlock("div",X)):s.createCommentVNode("",!0),!s.unref(o)&&i.value?(s.openBlock(),s.createBlock(H,{key:6,userInfo:s.unref(n)},null,8,["userInfo"])):s.createCommentVNode("",!0),e.passkeysEnabled?(s.openBlock(),s.createElementBlock("div",Y)):s.createCommentVNode("",!0),!s.unref(o)&&e.passkeysEnabled?(s.openBlock(),s.createBlock(c._sfc_main$2,{key:8,userInfo:s.unref(n),refreshDevices:s.unref(r),webauthnAllowed:e.webauthnAllowed},null,8,["userInfo","refreshDevices","webauthnAllowed"])):s.createCommentVNode("",!0)],64))}}),ee={key:1,class:"notification is-danger has-text-centered"},te=s.defineComponent({__name:"MainView",setup(e){const{appInfo:t,loading:n,invalidAppId:o,passage:a}=s.useAppInfo(),{webauthnAllowed:r,passkeysEnabled:l,initialized:i}=c.useSetupWebauthn(t,a);return(e,a)=>(s.openBlock(),s.createElementBlock(s.Fragment,null,[s.unref(n)||!s.unref(i)?(s.openBlock(),s.createBlock(c._sfc_main,{key:0,active:s.unref(n)||!s.unref(i)},null,8,["active"])):s.unref(o)?(s.openBlock(),s.createElementBlock("div",ee," Passage-Profile Error: Invalid App ID. ")):s.createCommentVNode("",!0),s.unref(t)&&s.unref(i)?(s.openBlock(),s.createBlock(Z,{key:2,appInfo:s.unref(t),webauthnAllowed:s.unref(r),passkeysEnabled:s.unref(l)},null,8,["appInfo","webauthnAllowed","passkeysEnabled"])):s.createCommentVNode("",!0)],64))}}),ne=s.defineComponent({__name:"Profile.ce",props:{appId:{},lang:{},defaultCountryCode:{},tokenStore:{},theme:{}},setup(e){const t=e,{languageLoading:n,containerRef:o,currentTheme:a}=c.useProfileElementSetup(t);return(e,t)=>s.withDirectives((s.openBlock(),s.createElementBlock("div",{id:"passage-profile-container",class:s.normalizeClass(["passage-profile",s.unref(a)]),ref_key:"containerRef",ref:o},[(s.openBlock(),s.createBlock(te,{key:e.appId}))],2)),[[s.vShow,!s.unref(n)]])}});function oe(){s.safelyRegisterElement(ne,"profile")}oe(),exports.registerPassageLoginElement=oe;
//# 
