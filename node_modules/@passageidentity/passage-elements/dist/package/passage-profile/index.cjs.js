"use strict";var e=(e,t,n)=>new Promise(((o,a)=>{var r=e=>{try{l(n.next(e))}catch(t){a(t)}},i=e=>{try{l(n.throw(e))}catch(t){a(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,i);l((n=n.apply(e,t)).next())}));Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var t=require("../customElements.js"),n=require("../useUpdateUser.js"),o=require("../useProfileElementSetup.js");const a=t.defineComponent({name:"Editable Control",props:{title:{type:String,required:!0},editable:{type:Boolean,default:!0},onSave:{type:Function,required:!1},onCancel:{type:Function,required:!1},isEditing:{type:Boolean,default:void 0},errorMessage:{type:String,required:!1}},emits:["update:isEditing","editStart"],setup(e,n){const{t:o}=t.useLocale(),a=t.ref(!1),r=t.computed({get:()=>void 0===e.isEditing?a.value:e.isEditing,set(t){void 0!==e.isEditing?(n.emit("update:isEditing",t),t&&n.emit("editStart")):a.value=t}});const i=t.ref(),l=t.ref(!1);const s=new ResizeObserver((()=>{!function(){if(void 0===i.value)return;const e=i.value.getBoundingClientRect().width;l.value=e<415}()}));return t.onMounted((()=>{i.value&&s.observe(i.value)})),t.onBeforeUnmount((()=>{s.disconnect()})),{isEditingValue:r,save:function(){void 0!==e.onSave?e.onSave().then((e=>{e&&(r.value=!1)})):r.value=!1},cancel:function(){void 0!==e.onCancel?e.onCancel().then((()=>{r.value=!1})):r.value=!1},container:i,isCompact:l,t:o}}}),r={class:"user-info-label"},i={class:"login-info-control"},l={key:0,class:"edit-save-container"},s={class:"message is-danger"},u={key:0};var d=t._export_sfc(a,[["render",function(e,n,o,a,d,c){return t.openBlock(),t.createElementBlock("form",{onSubmit:n[3]||(n[3]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"])),onKeyup:n[4]||(n[4]=t.withKeys(((...t)=>e.cancel&&e.cancel(...t)),["esc"]))},[t.createBaseVNode("div",{class:t.normalizeClass(["login-info-row",{isCompact:e.isCompact}]),ref:"container"},[t.createBaseVNode("div",r,t.toDisplayString(e.title),1),t.createBaseVNode("div",i,[t.renderSlot(e.$slots,"default")]),e.editable?(t.openBlock(),t.createElementBlock("div",l,[e.isEditing?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"edit-save-text",onClick:n[0]||(n[0]=t.withModifiers((t=>e.isEditingValue=!0),["prevent"])),"data-test":"edit-button"},t.toDisplayString(e.t("edit")),1)),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:1,class:"edit-save-text",onClick:n[1]||(n[1]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"])),"data-test":"save-button"},t.toDisplayString(e.t("save")),1)):t.createCommentVNode("",!0),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:2,class:"edit-save-text",onClick:n[2]||(n[2]=t.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"])),"data-test":"cancel-button"},t.toDisplayString(e.t("cancel")),1)):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0),t.createBaseVNode("div",s,[e.errorMessage?(t.openBlock(),t.createElementBlock("div",u,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("",!0)])],2)],32)}]]);const c=t.defineComponent({name:"Phone Number",components:{EditableControl:d},props:{userInfo:{type:Object,required:!1},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(o,a){var r;const{t:i}=t.useLocale(),l=t.ref(!1),{changePhoneRequest:s,updateInfoMessage:u,updatePhoneError:d,updatePending:c,identifierExists:p}=n.useUpdateUser(),f=t.computed((()=>{const e=i("phone-number");return e.charAt(0).toUpperCase()+e.slice(1)}));let v;(v||(v={})).NONE="N/A";const m=t.ref((null==(r=o.userInfo)?void 0:r.phone)||v.NONE);let g=m.value,y="";const k=t.ref(),E=t.ref(),{defaultCountryCode:h}=t.useDefaultCountryCode();let B;function C(){m.value.trim()||(m.value="N/A")}return t.watch(k,(()=>{var e;B=n.intlTelInput(k.value,{initialCountry:null!=(e=null==B?void 0:B.getSelectedCountryData().iso2)?e:h.value,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:E.value,autoPlaceholder:"aggressive"})})),{isEditing:l,phone:m,controlContainer:E,phoneInputBox:k,cancel:function(){return e(this,null,(function*(){d.value="",m.value=g,B&&(B.setCountry(y),m.value=m.value.replace(`+${null==B?void 0:B.getSelectedCountryData().dialCode}`,""))}))},save:function(){return e(this,null,(function*(){var t,n,r,l;const f=null!=(n=null==(t=o.userInfo)?void 0:t.phone)?n:"",v="N/A"===m.value?"":m.value;return d.value="",!o.required||null!=(r=null==B?void 0:B.getNumber())&&r?f===(null!=(l=null==B?void 0:B.getNumber())?l:"")?(C(),!0):(yield function(t,n){return e(this,null,(function*(){if(B){const e=null==B?void 0:B.getNumber();if(e&&!(null==B?void 0:B.isValidNumber()))return d.value=i("invalid-phone"),!1;if(n===e)return!1;if(e){const t=yield p(e).catch((()=>{d.value=i("something-went-wrong"),c.value=!1}));if(d.value)return!1;if(!t)return d.value=i("phone-number-already-in-use"),!1}if(n!==e)return yield s(e),""===d.value&&(a.emit("globalMessage",u.value),g=t,!0)}return!1}))}(v,f),!d.value&&(C(),!0)):(d.value=i("phone-number-is-required"),!1)}))},onEdit:function(){B&&(y=B.getSelectedCountryData().iso2),"N/A"===m.value?m.value="":m.value=m.value.replace(`+${null==B?void 0:B.getSelectedCountryData().dialCode}`,"")},updatePhoneError:d,updatePending:c,title:f,t:i}}}),p=["readonly"],f={ref:"controlContainer",style:{width:"100%"}};var v=t._export_sfc(c,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("loading"),s=t.resolveComponent("editable-control");return t.openBlock(),t.createElementBlock(t.Fragment,null,[e.updatePending?(t.openBlock(),t.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):t.createCommentVNode("",!0),t.createVNode(s,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":n[2]||(n[2]=t=>e.isEditing=t),errorMessage:e.updatePhoneError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:t.withCtx((()=>[t.withDirectives(t.createBaseVNode("input",{type:"text",id:"phone",class:t.normalizeClass(["input short",{"is-danger":e.updatePhoneError}]),part:"input","onUpdate:modelValue":n[0]||(n[0]=t=>e.phone=t),readonly:!e.isEditing,onInput:n[1]||(n[1]=t=>e.updatePhoneError=""),ref:"phoneInputBox",inputmode:"tel",autocomplete:"tel","data-test":"profile-phone-input"},null,42,p),[[t.vModelText,e.phone]]),t.createBaseVNode("div",f,null,512)])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const m=t.defineComponent({name:"Phone Number",components:{EditableControl:d},props:{userInfo:{type:Object,required:!1},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(o,a){var r;const{t:i}=t.useLocale(),l=t.ref(!1),{changeEmailRequest:s,updateInfoMessage:u,updateEmailError:d,updatePending:c,identifierExists:p}=n.useUpdateUser(),f=t.computed((()=>{const e=i("email");return e.charAt(0).toUpperCase()+e.slice(1)}));let v;(v||(v={})).NONE="N/A";const m=t.ref((null==(r=o.userInfo)?void 0:r.email)||v.NONE);let g=m.value;function y(){m.value.trim()||(m.value="N/A")}return{isEditing:l,email:m,cancel:function(){return e(this,null,(function*(){d.value="",m.value=g}))},save:function(){return e(this,null,(function*(){var t,r;const l=null!=(r=null==(t=o.userInfo)?void 0:t.email)?r:"",f="N/A"===m.value?"":m.value;return d.value="",o.required&&!f.trim()?(d.value=i("email-is-required"),!1):l===f.trim()?(y(),!0):(yield function(t,o){return e(this,null,(function*(){if(o!==t){const e=t.trim().toLowerCase();if(e&&!n.isEmail(m.value))return d.value=i("invalid-email"),!1;if(e){const t=yield p(e).catch((()=>{d.value=i("something-went-wrong"),c.value=!1}));if(d.value)return!1;if(!t)return d.value=i("email-address-already-in-use"),!1}if(yield s(e),""===d.value)return a.emit("globalMessage",u.value),g=t,!0}return!1}))}(f,l),!d.value&&(y(),!0))}))},onEdit:function(){"N/A"===m.value&&(m.value="")},updateEmailError:d,updatePending:c,title:f}}}),g=["readonly"];var y=t._export_sfc(m,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("loading"),s=t.resolveComponent("editable-control");return t.openBlock(),t.createElementBlock(t.Fragment,null,[e.updatePending?(t.openBlock(),t.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):t.createCommentVNode("",!0),t.createVNode(s,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":n[2]||(n[2]=t=>e.isEditing=t),errorMessage:e.updateEmailError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:t.withCtx((()=>[t.withDirectives(t.createBaseVNode("input",{type:"text",class:t.normalizeClass(["input short",{"is-danger":e.updateEmailError}]),part:"input",readonly:!e.isEditing,"onUpdate:modelValue":n[0]||(n[0]=t=>e.email=t),onInput:n[1]||(n[1]=t=>e.updateEmailError=""),inputmode:"email",autocomplete:"email","data-test":"profile-email-input"},null,42,g),[[t.vModelText,e.email]])])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const k=t.defineComponent({name:"UserInfo",components:{PhoneNumber:v,Email:y},props:{userInfo:{type:Object,required:!1},appInfo:{type:Object,required:!0}},setup(e){const{t:n}=t.useLocale(),o=t.ref("");const a=t.computed((()=>e.appInfo.allowed_identifier!==t.ce.phone)),r=t.computed((()=>e.appInfo.allowed_identifier!==t.ce.email)),i=t.computed((()=>e.appInfo.required_identifier===t.ue.Email||e.appInfo.required_identifier===t.ue.Both)),l=t.computed((()=>e.appInfo.required_identifier===t.ue.Phone||e.appInfo.required_identifier===t.ue.Both));return{message:o,globalMessage:function(e){o.value=e},showEmail:a,showPhone:r,emailRequired:i,phoneRequired:l,t:n}}}),E={class:"title secondary-title"},h={key:0};var B=t._export_sfc(k,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("email"),s=t.resolveComponent("phone-number");return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createBaseVNode("div",E,t.toDisplayString(e.t("login-info")),1),t.createBaseVNode("div",{class:t.normalizeClass(["feedback",e.message?"feedback-info":""])},[e.message?(t.openBlock(),t.createElementBlock("div",h,t.toDisplayString(e.message),1)):t.createCommentVNode("",!0)],2),e.showEmail?(t.openBlock(),t.createBlock(l,{key:0,userInfo:e.userInfo,required:e.emailRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["userInfo","required","editable","onGlobalMessage"])):t.createCommentVNode("",!0),e.showPhone?(t.openBlock(),t.createBlock(s,{key:1,userInfo:e.userInfo,required:e.phoneRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["userInfo","required","editable","onGlobalMessage"])):t.createCommentVNode("",!0)],64)}]]);const C=t.defineComponent({name:"Metadata Section",components:{UserMetadata:n.UserMetadata},props:{appInfo:{type:Object,required:!0},userInfo:{type:Object,required:!1},refreshMetadata:{type:Function,required:!0}},setup(o){const{t:a}=t.useLocale(),r=t.ref(!1),{updateMetadata:i,updateMetadataError:l}=n.useUpdateUser();const s=t.ref();return{LayoutType:n.LayoutType,isEditing:r,save:function(){return e(this,null,(function*(){var e;let t=!0;if(s.value){if(!s.value.validate())return;(null==(e=o.userInfo)?void 0:e.user_metadata)&&(t=yield i(o.userInfo.user_metadata,o.appInfo.user_metadata_schema))}r.value=!t}))},cancel:function(){return e(this,null,(function*(){yield o.refreshMetadata(),s.value&&s.value.validate(),r.value=!1}))},componentRef:s,updateMetadataError:l,t:a}}}),b={class:"metadata-header"},I={class:"title secondary-title"},N={key:0,class:"edit-save-container"},M={key:0},w={key:1,style:{"text-align":"center"}},V={class:"title secondary-title"};var S=t._export_sfc(C,[["render",function(e,n,o,a,r,i){var l;const s=t.resolveComponent("user-metadata");return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createBaseVNode("div",b,[t.createBaseVNode("div",I,t.toDisplayString(e.t("personal-info")),1),e.userInfo&&e.appInfo.profile_management?(t.openBlock(),t.createElementBlock("div",N,[e.isEditing?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"edit-save-text",onClick:n[0]||(n[0]=t.withModifiers((t=>e.isEditing=!0),["prevent"]))},t.toDisplayString(e.t("edit")),1)),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:1,class:"edit-save-text",onClick:n[1]||(n[1]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"]))},t.toDisplayString(e.t("save")),1)):t.createCommentVNode("",!0),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:2,class:"edit-save-text",onClick:n[2]||(n[2]=t.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"]))},t.toDisplayString(e.t("cancel")),1)):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0)]),t.createBaseVNode("div",{class:t.normalizeClass(["feedback",e.updateMetadataError?"feedback-danger":""])},[e.updateMetadataError?(t.openBlock(),t.createElementBlock("div",M,t.toDisplayString(e.updateMetadataError),1)):t.createCommentVNode("",!0)],2),e.userInfo?(t.openBlock(),t.createBlock(s,{key:0,appInfo:e.appInfo,layoutType:e.LayoutType.Profile,userMetadata:null!=(l=e.userInfo.user_metadata)?l:{},ref:"componentRef",isEditing:e.isEditing},null,8,["appInfo","layoutType","userMetadata","isEditing"])):(t.openBlock(),t.createElementBlock("div",w,[t.createBaseVNode("div",V,t.toDisplayString(e.t("no-user-found")),1),t.createBaseVNode("div",null,t.toDisplayString(e.t("there-is-no-currently-logged-in-user")),1)]))],64)}]]);const _={key:1,class:"notification is-danger has-text-centered"},q={key:3,class:"profile-divider"},P=t.createBaseVNode("div",{class:"profile-divider"},null,-1),x=t.defineComponent({__name:"ProfileView",props:{appId:{},appInfo:{},webauthnAllowed:{type:Boolean}},setup(e){const n=e,{userInfo:a,loading:r,error:i,refreshDevices:l,refreshMetadata:s}=o.useCurrentUser(n.appInfo);return(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(r)?(t.openBlock(),t.createBlock(o._sfc_main,{key:0,active:t.unref(r)},null,8,["active"])):t.unref(i)&&t.unref(i).statusCode!==t.unref(t.P).PSGLoginRequired?(t.openBlock(),t.createElementBlock("div",_," Unable to get information about current user: "+t.toDisplayString(t.unref(i).statusText),1)):t.createCommentVNode("",!0),t.unref(r)?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(B,{key:2,userInfo:t.unref(a),appInfo:e.appInfo},null,8,["userInfo","appInfo"])),e.appInfo.layouts.profile.length>0?(t.openBlock(),t.createElementBlock("div",q)):t.createCommentVNode("",!0),!t.unref(r)&&e.appInfo.layouts.profile.length>0?(t.openBlock(),t.createBlock(S,{key:4,appInfo:e.appInfo,userInfo:t.unref(a),refreshMetadata:t.unref(s)},null,8,["appInfo","userInfo","refreshMetadata"])):t.createCommentVNode("",!0),P,t.unref(r)?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(o._sfc_main$1,{key:5,userInfo:t.unref(a),refreshDevices:t.unref(l),webauthnAllowed:e.webauthnAllowed},null,8,["userInfo","refreshDevices","webauthnAllowed"]))],64))}}),D={key:1,class:"notification is-danger has-text-centered"},A=t.defineComponent({__name:"MainView",setup(n){const{appInfo:a,loading:r,invalidAppId:i,passage:l}=t.useAppInfo(),s=t.ref(!1),u=t.ref(!1);return t.watch(a,(()=>e(this,null,(function*(){if(u.value=!1,void 0===a.value||void 0===l.value)return;l.value.checkWebauthnConfig(a.value)&&(s.value=(yield l.value.createCredentialAvailable()).securityKey),u.value=!0})))),(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(r)||!u.value?(t.openBlock(),t.createBlock(o._sfc_main,{key:0,active:t.unref(r)||!u.value},null,8,["active"])):t.unref(i)?(t.openBlock(),t.createElementBlock("div",D," Passage-Profile Error: Invalid App ID. ")):t.createCommentVNode("",!0),t.unref(a)&&u.value?(t.openBlock(),t.createBlock(x,{key:2,appInfo:t.unref(a),webauthnAllowed:s.value},null,8,["appInfo","webauthnAllowed"])):t.createCommentVNode("",!0)],64))}}),U=t.defineComponent({__name:"Profile.ce",props:{appId:{},lang:{},defaultCountryCode:{},tokenStore:{}},setup(e){const n=e,{languageLoading:a,containerRef:r}=o.useProfileElementSetup(n);return(e,n)=>t.withDirectives((t.openBlock(),t.createElementBlock("div",{id:"passage-profile-container",ref_key:"containerRef",ref:r},[(t.openBlock(),t.createBlock(A,{key:e.appId}))],512)),[[t.vShow,!t.unref(a)]])}});function j(){t.safelyRegisterElement(U,"profile")}j(),exports.registerPassageLoginElement=j;
//# 
