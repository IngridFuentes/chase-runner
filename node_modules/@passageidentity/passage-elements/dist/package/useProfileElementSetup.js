"use strict";var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,i=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(n)for(var a of n(t))l.call(t,a)&&r(e,a,t[a]);return e},s=(e,t,a)=>new Promise(((n,o)=>{var l=e=>{try{i(a.next(e))}catch(t){o(t)}},r=e=>{try{i(a.throw(e))}catch(t){o(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,r);i((a=a.apply(e,t)).next())})),c=require("./customElements.js");const u=c.defineComponent({name:"Modal",props:{active:{type:Boolean,default:!1},title:{type:String,default:""},onPrimaryButton:{type:Function,required:!1},onCancelButton:{type:Function,required:!1},primaryButtonText:{type:String,default:"OK"},cancelButtonText:{type:String,default:"Cancel"},info:{type:Boolean,default:!1},cancelOnly:{type:Boolean,default:!1},danger:{type:Boolean,default:!1},centerTitle:{type:Boolean,default:!1}},setup(e,t){const a=c.ref(!1);c.watchEffect((()=>{a.value=e.active,a.value?document.documentElement.classList.add("is-clipped"):document.documentElement.classList.remove("is-clipped")}));return c.onUnmounted((()=>document.documentElement.classList.remove("is-clipped"))),{isActive:a,closeModal:()=>{a.value=!1},primaryAction:function(){void 0!==e.onPrimaryButton?e.onPrimaryButton().then((e=>{e&&t.emit("update:active",!1)})):t.emit("update:active",!1)},cancelAction:function(){void 0!==e.onCancelButton?e.onCancelButton().then((()=>{t.emit("update:active",!1)})):t.emit("update:active",!1)}}}}),d=c.createBaseVNode("div",{class:"passage-modal-background"},null,-1),v={class:"passage-modal-card"},p={key:0,class:"passage-modal-footer"};var m=c._export_sfc(u,[["render",function(e,t,a,n,o,l){return c.openBlock(),c.createBlock(c.Transition,{name:"modal",mode:"out-in"},{default:c.withCtx((()=>[e.isActive?(c.openBlock(),c.createElementBlock("div",{key:0,class:c.normalizeClass(["passage-modal",{"is-active":e.isActive}]),part:"modal",role:"dialog",onKeyup:[t[2]||(t[2]=c.withKeys(((...t)=>e.primaryAction&&e.primaryAction(...t)),["enter"])),t[3]||(t[3]=c.withKeys(((...t)=>e.cancelAction&&e.cancelAction(...t)),["esc"]))]},[d,c.createBaseVNode("div",v,[c.createBaseVNode("div",{class:c.normalizeClass(["title secondary-title",{"danger-header":e.danger,"has-text-centered":e.centerTitle}])},c.toDisplayString(e.title),3),c.createBaseVNode("div",{class:c.normalizeClass(["passage-modal-body",{centered:e.centerTitle}])},[c.renderSlot(e.$slots,"default")],2),e.info&&e.cancelOnly?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("div",p,[e.cancelOnly?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("button",{key:0,class:"button is-modal",part:"modal-button modal-primary",onClick:t[0]||(t[0]=c.withModifiers(((...t)=>e.primaryAction&&e.primaryAction(...t)),["prevent"])),"data-test":"primary-modal-button"},c.toDisplayString(e.primaryButtonText),1)),e.info?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("button",{key:1,class:c.normalizeClass(["button is-secondary is-modal cancel-button",{"cancel-only":e.cancelOnly}]),part:"modal-button modal-secondary",onClick:t[1]||(t[1]=c.withModifiers(((...t)=>e.cancelAction&&e.cancelAction(...t)),["prevent"])),"data-test":"secondary-modal-button"},c.toDisplayString(e.cancelButtonText),3))]))])],34)):c.createCommentVNode("",!0)])),_:3})}]]);const f=c.defineComponent({name:"Revoke Device",components:{Modal:m},props:{device:{type:Object,required:!0},active:{type:Boolean,required:!0},currentDeviceId:{type:String,required:!1}},emits:["dialogClose","update:active"],setup(e,t){const{t:a}=c.useLocale(),n=c.computed({get:()=>e.active,set(e){t.emit("update:active",e)}}),{revokeDevice:o,revokePending:l,errorMessage:r}=function(){const{t:e}=c.useLocale(),{passage:t}=c.usePassage(),a=t.getCurrentUser(),n=c.ref(!1),o=c.ref("");return{revokeDevice:function(t){return s(this,null,(function*(){n.value=!0;try{return yield a.deleteDevice(t),!0}catch(l){return o.value=e("failed-to-revoke-this-device"),!1}finally{n.value=!1}}))},revokePending:n,errorMessage:o}}();return{showModal:n,onDeleteDevice:function(){return s(this,null,(function*(){if(r.value)return t.emit("dialogClose"),!0;const a=yield o(e.device);return a&&t.emit("dialogClose"),a}))},revokePending:l,errorMessage:r,t:a}}}),g={key:1},y={key:0},k={key:2,class:"text is-danger"};var B=c._export_sfc(f,[["render",function(e,t,a,n,o,l){const r=c.resolveComponent("loading"),i=c.resolveComponent("modal");return c.openBlock(),c.createBlock(i,{title:e.t("revoke-device"),active:e.showModal,"onUpdate:active":t[0]||(t[0]=t=>e.showModal=t),primaryButtonText:e.errorMessage?e.t("ok"):e.t("revoke-device"),onPrimaryButton:e.onDeleteDevice,info:!!e.errorMessage},{default:c.withCtx((()=>{var t;return[e.revokePending?(c.openBlock(),c.createBlock(r,{key:0,active:e.revokePending},null,8,["active"])):c.createCommentVNode("",!0),e.errorMessage?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("div",g,[c.createTextVNode(c.toDisplayString(e.t("confirm-remove-device"))+" ",1),(null==(t=e.device)?void 0:t.id)===e.currentDeviceId?(c.openBlock(),c.createElementBlock("b",y,c.toDisplayString(e.t("remove-current-device-warning")),1)):c.createCommentVNode("",!0),c.createTextVNode(" "+c.toDisplayString(e.t("are-you-sure-you-want-to-continue")),1)])),e.errorMessage?(c.openBlock(),c.createElementBlock("div",k,c.toDisplayString(e.errorMessage),1)):c.createCommentVNode("",!0)]})),_:1},8,["title","active","primaryButtonText","onPrimaryButton","info"])}]]);const b={class:"has-text-centered"},h={key:1,class:"text is-danger has-text-centered"},C={key:2},N={style:{"margin-bottom":"12px"}},w={style:{"margin-bottom":"22px"}},D={key:3,class:"flex-row flex-center"},V=["onClick","disabled"],x=["onClick","disabled"],_={key:4,class:"flex-row flex-center"},S=["onClick","disabled"],M={class:"link has-text-centered",style:{"margin-top":"32px"}},E=["onClick"],I=c.defineComponent({__name:"AddDevice",props:{active:{type:Boolean},browserFeatures:{}},emits:["dialogClose","update:active"],setup(e,{emit:t}){const a=e,{t:n}=c.useLocale(),o=c.computed({get:()=>a.active,set(e){t("update:active",e)}}),l=c.computed((()=>{var e,t;return null!=(t=null==(e=a.browserFeatures)?void 0:e.platform)&&t})),r=c.computed((()=>{var e,t;return null!=(t=null==(e=a.browserFeatures)?void 0:e.securityKey)&&t})),{addDevice:i,addPending:u,errorMessage:d}=c.useAddDevice(),v=c.ref();let p=c.E.Platform;function f(e){return s(this,null,(function*(){return p=e,v.value=yield i(e),!!v.value&&(o.value=!1,t("dialogClose"),!0)}))}function g(){!0===l.value?f(c.E.Platform):f(c.E.CrossPlatform)}function y(){f(c.E.CrossPlatform)}function k(){f(p)}function B(){d.value="",o.value=!1}return(e,t)=>{const a=c.resolveComponent("loading");return c.openBlock(),c.createBlock(m,{title:c.unref(n)("add-passkey"),active:o.value,"onUpdate:active":t[0]||(t[0]=e=>o.value=e),"cancel-only":"",info:"","center-title":""},{default:c.withCtx((()=>[c.unref(u)?(c.openBlock(),c.createBlock(a,{key:0,active:c.unref(u)},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("figure",b,[c.unref(d)?(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:0,src:c.unref(c.Icons).fingerprintFailed,alt:"Biometrics scan failed"},null,8,["src"])):(c.openBlock(),c.createBlock(c.unref(c.InlineSvg),{key:1,src:c.unref(c.Icons).passkey,alt:"Register with a passkey"},null,8,["src"]))]),c.unref(d)?(c.openBlock(),c.createElementBlock("div",h,c.toDisplayString(c.unref(d)),1)):c.createCommentVNode("",!0),c.unref(d)?c.createCommentVNode("",!0):(c.openBlock(),c.createElementBlock("div",C,[c.createBaseVNode("div",N,c.toDisplayString(c.unref(n)("passkeys-are-a-simple")),1),c.createBaseVNode("div",w,c.toDisplayString(c.unref(n)("passkey-register-options")),1)])),c.unref(d)?(c.openBlock(),c.createElementBlock("div",_,[c.createBaseVNode("button",{onClick:c.withModifiers(k,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:c.unref(u),style:{"margin-right":"5px",width:"auto"},"data-test":"add-device-primary-button"},c.toDisplayString(c.unref(n)("try-again")),9,S)])):(c.openBlock(),c.createElementBlock("div",D,[c.createBaseVNode("button",{onClick:c.withModifiers(g,["prevent"]),type:"button",part:"button",class:"button is-primary",disabled:c.unref(u),style:{"margin-right":"5px",width:"auto"},"data-test":"add-device-primary-button"},c.toDisplayString(l.value?c.unref(n)("continue"):c.unref(n)("use-another-device")),9,V),l.value&&r.value?(c.openBlock(),c.createElementBlock("button",{key:0,onClick:c.withModifiers(y,["prevent"]),type:"button",part:"button button-secondary",class:"button is-secondary",disabled:c.unref(u),style:{"margin-left":"5px"},"data-test":"add-device-secondary-button"},c.toDisplayString(c.unref(n)("use-another-device")),9,x)):c.createCommentVNode("",!0)])),c.createBaseVNode("div",M,[c.createBaseVNode("a",{onClick:c.withModifiers(B,["prevent"]),role:"button","data-test":"add-device-skip"},c.toDisplayString(c.unref(n)("cancel")),9,E)])])),_:1},8,["title","active"])}}});const P={class:"label input-box-title"},L={class:"message is-danger"},T={key:1,class:"text is-danger"},O=c.defineComponent({__name:"EditDevice",props:{deviceObject:{},active:{type:Boolean},newDevice:{type:Boolean}},emits:["dialogClose","update:active"],setup(e,{emit:t}){const a=e,{t:n}=c.useLocale(),o=c.computed({get:()=>a.active,set(e){t("update:active",e)}});function l(){i.value="",p.value=""}function r(){return s(this,null,(function*(){t("dialogClose"),l()}))}const i=c.ref(""),u=c.ref("");c.onUpdated((()=>{var e,t;u.value=null!=(t=null==(e=a.deviceObject)?void 0:e.friendly_name)?t:""})),c.onMounted((()=>{var e,t;u.value=null!=(t=null==(e=a.deviceObject)?void 0:e.friendly_name)?t:""}));const{renameDevice:d,editPending:v,errorMessage:p}=function(){const{t:e}=c.useLocale(),{passage:t}=c.usePassage(),a=t.getCurrentUser(),n=c.ref(!1),o=c.ref("");return{renameDevice:function(t,l){return s(this,null,(function*(){n.value=!0;try{return yield a.editDevice(t,{friendly_name:l}),!0}catch(r){return o.value=e("failed-to-rename-this-device"),!1}finally{n.value=!1}}))},editPending:n,errorMessage:o}}();function f(){return s(this,null,(function*(){if(!a.deviceObject)return!1;if(p.value)return t("dialogClose"),l(),!0;if(u.value===a.deviceObject.friendly_name)return t("dialogClose"),!0;if(!u.value)return i.value=n("device-name-is-required"),!1;if(u.value.length>64)return i.value=n("device-name-maximum"),!1;const e=yield d(a.deviceObject.id,u.value);return e?(t("dialogClose"),!0):e}))}const g=c.ref();return c.watch(g,(()=>{void 0!==g.value&&null!==g.value&&g.value.focus()})),(e,t)=>{const a=c.resolveComponent("loading");return c.openBlock(),c.createBlock(m,{title:e.newDevice?c.unref(n)("name-this-device"):c.unref(n)("edit-device"),active:o.value,"onUpdate:active":t[1]||(t[1]=e=>o.value=e),primaryButtonText:c.unref(p)?c.unref(n)("ok"):e.newDevice?c.unref(n)("add-device"):c.unref(n)("rename-device"),onPrimaryButton:f,onCancelButton:r,info:e.newDevice},{default:c.withCtx((()=>[c.unref(v)?(c.openBlock(),c.createBlock(a,{key:0,active:c.unref(v)},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("div",null,c.toDisplayString(e.newDevice?c.unref(n)("give-this-device-a-name"):c.unref(n)("rename-this-device")),1),c.createBaseVNode("div",P,c.toDisplayString(e.newDevice?c.unref(n)("device-name"):c.unref(n)("new-device-name")),1),c.withDirectives(c.createBaseVNode("input",{type:"text",class:c.normalizeClass(["input",{"is-danger":i.value}]),"onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),onInput:l,part:"input",ref_key:"editDeviceInput",ref:g,"data-test":"passkey-name-input"},null,34),[[c.vModelText,u.value]]),c.createBaseVNode("div",L,c.toDisplayString(i.value),1),c.unref(p)?(c.openBlock(),c.createElementBlock("div",T,c.toDisplayString(c.unref(p)),1)):c.createCommentVNode("",!0)])),_:1},8,["title","active","primaryButtonText","info"])}}}),A=c.defineComponent({name:"Loading",props:{active:Boolean},setup:(e,{attrs:n})=>()=>e.active?c.h$1(c.Transition,{name:"fade",mode:"out-in"},(()=>{return[c.h$1("div",(e=i({},n),o={class:["component-loading loading-overlay is-overlay"],title:"Loading..."},t(e,a(o))),[c.h$1("div",{class:["loading-background is-overlay"]},""),c.h$1("div",{class:["loading-icon"]})])];var e,o})):null}),j={key:0,class:"passage-table-paginator"},z={class:"page-size-selector"},U={style:{"margin-right":"15px"}},F={class:"paginator-text"},Y={class:"paginator-buttons flex-row"},$=["onClick"],R=["onClick"],q=["onClick"],K=["onClick"],G=["onClick"],J=c.defineComponent({__name:"Paginator",props:{dataset:{},page:{}},emits:["update:page"],setup(e,{emit:t}){const a=e,{t:n}=c.useLocale(),o=c.ref(5),l=[{name:"5",value:5},{name:"10",value:10},{name:"15",value:15}],r=c.computed((()=>i.value.length>1||void 0!==a.dataset&&a.dataset.length>5)),i=c.computed((()=>{if(void 0===a.dataset||0===a.dataset.length)return[];const e=[];for(let t=0;t<a.dataset.length;t+=o.value){const n=a.dataset.slice(t,t+o.value);e.push(n)}return u.value=e[0],d.value=0,e})),s=c.ref([]),u=c.computed({get:()=>s.value,set(e){s.value=e,t("update:page",e)}}),d=c.ref(0),v=c.computed({get:()=>d.value,set(e){d.value=e,i.value&&(u.value=i.value[e])}}),p=c.computed((()=>{var e,t;const l=v.value,r=o.value,i=null!=(t=null==(e=a.dataset)?void 0:e.length)?t:0,s=l*r+1,c=Math.min(l*r+r,i);return n("showing-page-of-n",[s,c,i])})),m=(e,t,a)=>Array.from({length:(t-e)/a+1},((t,n)=>e+n*a)),f=c.computed((()=>{if(i.value.length<3)return m(0,i.value.length-1,1);if(0===v.value)return m(0,2,1);const e=i.value.length;return v.value===e-1?m(e-3,e-1,1):m(v.value-1,v.value+1,1)}));function g(){v.value=0}function y(){0!==v.value&&(v.value-=1)}function k(){v.value!==i.value.length-1&&(v.value+=1)}function B(){v.value!==i.value.length-1&&(v.value=i.value.length-1)}return(e,t)=>r.value?(c.openBlock(),c.createElementBlock("div",j,[c.createBaseVNode("div",z,[c.createBaseVNode("span",U,c.toDisplayString(c.unref(n)("rows-per-page")),1),c.createVNode(c.Dropdown,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),items:l},null,8,["modelValue"])]),c.createBaseVNode("div",F,c.toDisplayString(p.value),1),c.createBaseVNode("div",Y,[c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:0===v.value}]),part:"paginator-button",onClick:c.withModifiers(g,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).doubleChevronLeft,alt:"First page"},null,8,["src"])],10,$),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:0===v.value}]),part:"paginator-button",onClick:c.withModifiers(y,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).chevronLeft,alt:"Previous page"},null,8,["src"])],10,R),(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(f.value,(e=>(c.openBlock(),c.createElementBlock("div",{key:e,class:c.normalizeClass(["paginator-button",{selected:e===v.value}]),part:"paginator-button",onClick:c.withModifiers((t=>{return a=e,void(v.value=a);var a}),["prevent"])},c.toDisplayString(e+1),11,q)))),128)),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:v.value===i.value.length-1}]),part:"paginator-button",onClick:c.withModifiers(k,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).chevronRight,alt:"Next page"},null,8,["src"])],10,K),c.createBaseVNode("div",{class:c.normalizeClass(["paginator-button",{disabled:v.value===i.value.length-1}]),part:"paginator-button",onClick:c.withModifiers(B,["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).doubleChevronRight,alt:"Last page"},null,8,["src"])],10,G)])])):c.createCommentVNode("",!0)}});var H=(e=>(e.default="DEFAULT",e.danger="DANGER",e))(H||{});const Q={class:"action-menu"},W=["onMousedown","data-test"],X=c.defineComponent({__name:"ActionMenu",props:{actions:{}},setup(e){const t=c.ref(!1);function a(e){t.value=void 0===e?!t.value:e}return(e,n)=>(c.openBlock(),c.createElementBlock("div",Q,[c.createBaseVNode("div",{class:"menu-icon",onClick:n[0]||(n[0]=c.withModifiers((e=>a()),["prevent"])),onFocusout:n[1]||(n[1]=c.withModifiers((e=>a(!1)),["prevent"])),tabindex:"0","data-test":"action-menu-button"},[c.createVNode(c.unref(c.InlineSvg),{src:c.unref(c.Icons).ellipsis,alt:"Action menu"},null,8,["src"])],32),c.createBaseVNode("div",{class:c.normalizeClass(["menu-dropdown",{collapsed:!t.value}])},[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(e.actions,(e=>(c.openBlock(),c.createElementBlock("div",{class:c.normalizeClass(["menu-item",{danger:e.type===c.unref(H).danger}]),key:e.displayName,onMousedown:t=>e.action(),"data-test":e.testID},c.toDisplayString(e.displayName),43,W)))),128))],2)]))}}),Z={class:"passage-table-header-row",part:"passage-table-header-row"},ee={key:0,class:"passage-table-header-cell passage-expansion-cell",part:"passage-table-header-cell"},te=c.createBaseVNode("th",{class:"passage-table-header-cell passage-action-menu-cell",part:"passage-table-header-cell"},null,-1),ae=["data-test"],ne=["data-test"],oe=["onClick"],le={colspan:3,class:"passage-table-cell",part:"passage-table-cell"},re={class:"expanded-content"},ie={class:"expanded-label"},se={key:1,class:"passage-table-empty"},ce=["colspan"],ue={class:"title secondary-title","data-test":"empty-table"},de=c.defineComponent({__name:"SimpleDataTable",props:{dataset:{},headers:{},columns:{},mobileBreakpoint:{},actions:{}},setup(e){const t=e,a=c.ref(),{t:n}=c.useLocale(),o=c.ref(),l=new ResizeObserver((()=>{i()})),r=c.ref(!1);function i(){if(void 0===o.value)return;const e=o.value.getBoundingClientRect().width;r.value=e<t.mobileBreakpoint}const s=c.ref([]);function u(e){if(null==e.target)return;const t=e.target.previousSibling;return null!=t?t:void 0}function d(e){const t=u(e);void 0!==t&&(t.className="passage-table-row passage-table-row-hover")}function v(e){const t=u(e);void 0!==t&&(t.className="passage-table-row")}function p(e){var a;return void 0===t.actions?[]:null==(a=t.actions)?void 0:a.map((t=>({displayName:t.displayName,testID:t.testID,type:t.type,action:()=>{t.action(e)}})))}return c.watch(a,(()=>{void 0!==a.value&&(s.value=a.value.map((()=>!1)))})),c.onMounted((()=>{i(),o.value&&l.observe(o.value)})),c.onUnmounted((()=>{l.disconnect()})),(e,t)=>(c.openBlock(),c.createElementBlock("div",null,[c.createBaseVNode("table",{class:"passage-table",ref_key:"tableContainer",ref:o,part:"passage-table"},[c.createBaseVNode("tbody",null,[c.createBaseVNode("tr",Z,[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(r.value?[e.headers[0]]:e.headers,(e=>(c.openBlock(),c.createElementBlock("th",{key:e,class:"passage-table-header-cell",part:"passage-table-header-cell"},c.toDisplayString(e),1)))),128)),r.value?(c.openBlock(),c.createElementBlock("th",ee)):c.createCommentVNode("",!0),te]),a.value?(c.openBlock(!0),c.createElementBlock(c.Fragment,{key:0},c.renderList(a.value,((t,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,{key:a},[c.createBaseVNode("tr",{class:"passage-table-row",part:"passage-table-row","data-test":`passkey-table-row-${a}`},[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(r.value?[e.columns[0]]:e.columns,((n,o)=>(c.openBlock(),c.createElementBlock("td",{key:n,class:c.normalizeClass(["passage-table-cell",{expanded:r.value&&s.value[a]}]),part:"passage-table-cell","data-test":`passkey-table-cell-${o}`},[c.renderSlot(e.$slots,n,{value:t[n],item:t},(()=>[c.createTextVNode(c.toDisplayString(t[n]),1)]))],10,ne)))),128)),r.value?(c.openBlock(),c.createElementBlock("td",{key:0,class:c.normalizeClass(["passage-table-cell passage-expansion-cell",{expanded:r.value&&s.value[a]}]),part:"passage-table-cell",onClick:c.withModifiers((e=>function(e){s.value[e]=!s.value[e]}(a)),["prevent"])},[c.createVNode(c.unref(c.InlineSvg),{class:c.normalizeClass(["table-chevron",{expanded:s.value[a]}]),src:c.unref(c.Icons).tableChevronDown,alt:"Expand row"},null,8,["src","class"])],10,oe)):c.createCommentVNode("",!0),c.createBaseVNode("td",{class:c.normalizeClass(["passage-table-cell passage-action-menu-cell",{expanded:r.value&&s.value[a]}]),part:"passage-table-cell"},[c.createVNode(X,{actions:p(t)},null,8,["actions"])],2)],8,ae),r.value&&s.value[a]?(c.openBlock(),c.createElementBlock("tr",{key:0,class:"passage-expansion-row",part:"passage-table-expansion-row",onMouseenter:d,onMouseleave:v},[c.createBaseVNode("td",le,[c.createBaseVNode("div",re,[(c.openBlock(!0),c.createElementBlock(c.Fragment,null,c.renderList(e.columns.slice(1),((a,n)=>(c.openBlock(),c.createElementBlock("div",{class:"expanded-item",key:a},[c.createBaseVNode("div",ie,c.toDisplayString(e.headers[n+1]),1),c.createBaseVNode("span",null,[c.renderSlot(e.$slots,a,{value:t[a],item:t},(()=>[c.createTextVNode(c.toDisplayString(t[a]),1)]))])])))),128))])])],32)):c.createCommentVNode("",!0)],64)))),128)):(c.openBlock(),c.createElementBlock("tr",se,[c.createBaseVNode("td",{class:"passage-table-empty-cell",colspan:r.value?3:e.columns.length+1},[c.createBaseVNode("div",ue,c.toDisplayString(c.unref(n)("no-devices-found")),1),c.createBaseVNode("div",null,c.toDisplayString(c.unref(n)("there-are-no-devices-registered")),1)],8,ce)]))])],512),c.createVNode(J,{dataset:e.dataset,page:a.value,"onUpdate:page":t[0]||(t[0]=e=>a.value=e)},null,8,["dataset","page"])]))}}),ve={class:"flex-row flex-end",style:{"margin-bottom":"30px"}},pe={class:"title secondary-title"},me=c.createBaseVNode("div",{class:"spacer"},null,-1),fe={class:"flex-row",style:{"align-items":"center"}},ge={key:0,class:"current-device"},ye=c.defineComponent({__name:"DevicesTable",props:{userInfo:{},refreshDevices:{type:Function},webauthnAllowed:{type:Boolean}},setup(e){const t=e,{t:a}=c.useLocale(),n=c.ref(),o=c.ref(0),l=c.ref(!1),r=c.ref(!1),i=c.ref(!1),{passage:u}=c.usePassage(),d=c.ref();u.createCredentialAvailable().then((e=>d.value=e));const v=c.computed((()=>{if(void 0===t.userInfo)return[];return t.userInfo.webauthn_devices.map((e=>e)).sort(((e,t)=>new Date(e.last_login_at)>new Date(t.last_login_at)?-1:1))}));function p(){if(void 0!==t.userInfo)if(null!==n.value&&void 0!==n.value){if(t.userInfo.webauthn_devices.length>5){const e=n.value.getBoundingClientRect().height;o.value=Math.ceil(e)}}else o.value=0;else o.value=0}const m=c.ref();function f(e){m.value=e,i.value=!0}function g(e){m.value=e,l.value=!0}const y=c.computed((()=>[{displayName:a("edit-device"),type:H.default,action:f,testID:"edit-passkey-button"},{displayName:a("revoke-device"),type:H.danger,action:g,testID:"revoke-passkey-button"}]));c.onUpdated((()=>{p()})),c.onMounted((()=>s(this,null,(function*(){p()}))));const k=c.computed((()=>{var e,a;if(void 0===t.userInfo)return;const n=localStorage.getItem("psg_cred_obj");if(!n)return;const o=JSON.parse(n)[null!=(a=null==(e=t.userInfo)?void 0:e.id)?a:""];return t.userInfo.webauthn_devices.find((e=>e.cred_id===o))})),b=c.ref(!1);function h(){return s(this,null,(function*(){m.value=void 0,b.value=!0,yield t.refreshDevices(),b.value=!1}))}return(e,t)=>{var s;return c.openBlock(),c.createElementBlock("div",{class:"table-container",style:c.normalizeStyle(`min-height: ${o.value}px`),ref_key:"tableContainerRef",ref:n},[b.value?(c.openBlock(),c.createBlock(A,{key:0,active:b.value},null,8,["active"])):c.createCommentVNode("",!0),c.createBaseVNode("div",ve,[c.createBaseVNode("div",pe,c.toDisplayString(c.unref(a)("my-passkeys")),1),me,e.userInfo&&e.webauthnAllowed?(c.openBlock(),c.createElementBlock("button",{key:0,part:"button button-secondary",class:"button is-secondary is-modal",onClick:t[0]||(t[0]=c.withModifiers((e=>r.value=!0),["prevent"])),"data-test":"add-passkey-button"},c.toDisplayString(c.unref(a)("add-device")),1)):c.createCommentVNode("",!0)]),c.createVNode(de,{dataset:v.value,headers:[c.unref(a)("name"),c.unref(a)("added-time"),c.unref(a)("last-login")],columns:["friendly_name","created_at","last_login_at"],"mobile-breakpoint":500,actions:y.value},{friendly_name:c.withCtx((({value:e,item:t})=>{var n;return[c.createBaseVNode("div",fe,[c.createTextVNode(c.toDisplayString(e)+" ",1),(null==(n=k.value)?void 0:n.id)===t.id?(c.openBlock(),c.createElementBlock("div",ge,c.toDisplayString(c.unref(a)("current")),1)):c.createCommentVNode("",!0)])]})),created_at:c.withCtx((({value:e})=>[c.createTextVNode(c.toDisplayString(c.unref(c.dayjs)(e).format("MMM D, YYYY")),1)])),last_login_at:c.withCtx((({value:e})=>[c.createTextVNode(c.toDisplayString(c.unref(c.dayjs)(e).format("MMM D, YYYY")),1)])),_:1},8,["dataset","headers","actions"]),c.createVNode(I,{active:r.value,"onUpdate:active":t[1]||(t[1]=e=>r.value=e),onDialogClose:h,"browser-features":d.value},null,8,["active","browser-features"]),m.value?(c.openBlock(),c.createBlock(B,{key:1,active:l.value,"onUpdate:active":t[2]||(t[2]=e=>l.value=e),device:m.value,currentDeviceId:null==(s=k.value)?void 0:s.id,onDialogClose:h},null,8,["active","device","currentDeviceId"])):c.createCommentVNode("",!0),c.createVNode(O,{active:i.value,"onUpdate:active":t[3]||(t[3]=e=>i.value=e),deviceObject:m.value,onDialogClose:h},null,8,["active","deviceObject"])],4)}}});exports._sfc_main=A,exports._sfc_main$1=ye,exports.useCurrentUser=function(e){const t=c.ref(!0),a=c.ref(void 0),n=c.ref(void 0),{passage:o}=c.usePassage(),l=o.getCurrentUser();function r(){void 0!==e&&e.user_metadata_schema.forEach((e=>{if(!n.value||!n.value.user_metadata)return;const t=n.value.user_metadata[e.field_name];e.type===c.le.DATE&&t&&(n.value.user_metadata[e.field_name]=c.dayjs(t).format("MM/DD/YYYY"))}))}return c.onMounted((()=>{!function(){s(this,null,(function*(){try{t.value=!0,l&&(n.value=yield l.userInfo(),void 0!==n.value&&null===n.value.user_metadata&&(n.value.user_metadata={}),r())}catch(e){a.value=e}finally{t.value=!1}}))}()})),{userInfo:n,loading:t,error:a,refreshDevices:function(){return s(this,null,(function*(){if(n.value)try{n.value.webauthn_devices=yield l.listDevices()}catch(e){a.value=e}finally{t.value=!1}}))},refreshMetadata:function(){return s(this,null,(function*(){var e;if(n.value)try{n.value.user_metadata=null!=(e=yield l.getMetadata())?e:{},r()}catch(o){a.value=o}finally{t.value=!1}}))}}},exports.useProfileElementSetup=function(e){function t(){const{updateDefaultCountryCode:t}=c.useDefaultCountryCode();t(e.defaultCountryCode),e.appId&&c.createPassageInstance(e.appId,e.tokenStore)}t(),c.onBeforeUpdate((()=>{t()}));const{languageLoading:a}=c.useStoreLocale(e),n=c.ref();return c.useIntlTelInput(n),{languageLoading:a,containerRef:n}};
//# 
