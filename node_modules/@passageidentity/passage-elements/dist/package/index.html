<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <link rel="icon" href="<%= BASE_URL %>favicon.ico" />
        <title>Passage Local</title>
    </head>
    <style>
        body {
            background: #e5e5e5;
        }

        .container {
            background: white;
            box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
            border-radius: 20px;
            width: 360px;
            margin: 30px auto;
        }

        .profile-container {
            width: 100%;
        }

        .darkmode.container {
            background: black;
            border-radius: 20px;
        }

        .darkmode passage-auth,
        .darkmode passage-login,
        .darkmode passage-register,
        .darkmode passage-profile {
            --passage-container-background-color: black;

            --passage-body-text-color: white;
            --passage-header-text-color: white;
            --passage-header-font-size: 28px;
            --passage-body-font-size: 15px;
            --passage-body-font-family: 'Courier', Helvetica, Arial, sans-serif;
            --passage-header-font-family: 'Courier', Helvetica, Arial, sans-serif;

            --passage-button-width: 100%;
            --passage-button-font-size: 18px;

            --passage-primary-button-border-radius: 0px;
            --passage-primary-button-background-color: #e40914;
            --passage-primary-button-text-color: white;

            --passage-primary-button-background-hover-color: #970108;
            --passage-primary-button-text-hover-color: white;

            --passage-primary-button-background-active-color: #970108;
            --passage-primary-button-text-active-color: white;

            --passage-secondary-button-border-radius: 0px;
            --passage-secondary-button-background-color: black;
            --passage-secondary-button-border-color: white;
            --passage-secondary-button-text-color: white;

            --passage-secondary-button-background-hover-color: #333333;
            --passage-secondary-button-border-hover-color: white;
            --passage-secondary-button-text-hover-color: white;

            --passage-secondary-button-background-active-color: #333333;
            --passage-secondary-button-border-active-color: white;
            --passage-secondary-button-text-active-color: white;

            --passage-input-text-color: white;
            --passage-input-box-border-radius: 0px;
            --passage-control-border-color: gray;
            --passage-control-border-active-color: white;
            --passage-input-box-background-color: #333333;

            --passage-control-border-radius: 0px;
            --passage-checkbox-background-color: #333333;
            --passage-checkbox-text-color: red;

            --passage-otp-input-background-color: #333333;

            --passage-anchor-text-color: white;
            --passage-anchor-hover-color: white;

            --passage-table-header-border-color: #e40914;
            --passage-table-row-hover-color: #333333;
            --passage-table-row-border-color: white;
            --passage-table-paginator-selected-color: #333333;
            --passage-table-paginator-hover-color: #333333;
        }
    </style>
    <body>
        <noscript>
            <strong
                >We're sorry but Passage Local doesn't work properly without JavaScript enabled. Please enable it to
                continue.</strong
            >
        </noscript>
        <button id="theme-toggle" onclick="toggleTheme()">Dark Mode</button>
        <select id="language-toggle" onchange="changeLocale(this)">
            <option value="auto">Auto</option>
            <option value="en">English</option>
            <option value="de">German</option>
            <option value="it">Italian</option>
        </select>
        <select id="element-selector" onchange="changeElement(this.value)">
            <option value="passage-auth">Passage Auth</option>
            <option value="passage-login">Passage Login</option>
            <option value="passage-register">Passage Register</option>
        </select>
        <input id="app-id-input" type="text" onchange="changeAppId(this.value)" value="preflight" />
        <div class="container" id="passage-element-container"></div>
        <div class="container profile-container" id="passage-profile-container">
            <!-- <passage-profile app-id="VVpa6Oiji8WRdikYnxbueqRb" default-country-code="us"></passage-profile> -->
        </div>
        <script src="index.umd.js"></script>
        <script>
            // Custom Token Store
            class CustomTokenStore extends Passage.TokenStore {
                async getAuthToken() {
                    const localToken = localStorage.getItem('custom_auth_token');
                    return localToken ?? '';
                }
                async setTokens(authResult) {
                    localStorage.setItem('custom_auth_token', authResult.auth_token);
                    if (authResult.refresh_token) {
                        localStorage.setItem('custom_auth_token', authResult.refresh_token);
                    }
                    return;
                }
                async getRefreshToken() {
                    const refreshToken = localStorage.getItem('custom_refresh_token');
                    return refreshToken ?? undefined;
                }
                async clearTokens() {
                    localStorage.removeItem('custom_auth_token');
                    return;
                }
            }
            const customTokenStore = new CustomTokenStore();

            let appId = 'preflight';
            loadAppId();
            let elementType = 'passage-auth';

            window.onload = renderElements;
            const onSuccess = (data) => {
                console.log('hit onSuccess() in index.html, data:', data);
            };

            const beforeAuth = (data) => {
                console.log('hit beforeAuth() in index.html, data:', data);
                return true;
            };

            const onEvent = (type, data) => {
                console.log('hit onEvent --->', type);
                if (type === 'onLoaded') {
                    /*PassageDebug.eventHandler.handleEvent({
                        type: 'CreatedUser',
                        payload: { identifier: 'kevin+test@passage.id', identifierType: 'EMAIL' },
                    });*/
                    /*PassageDebug.eventHandler.handleEvent({
                        type: 'FallbackAuthSuccess',
                        payload: { identifier: 'kevin+test@passage.id', authResult: {auth_token: 'Im a token', redirect_url: '/dashboard'} },
                    });*/
                }
            };
            try {
                const PassageUser = window.Passage.PassageUser;
                new PassageUser()
                    .userInfo()
                    .then((value) => console.log('successfully fetched PassageUser.userInfo in index.html:', value));
            } catch {
                console.log('No auth token.');
            }

            const theme = localStorage.getItem('theme');
            let isDark = false;
            if (theme === 'dark') {
                document.querySelectorAll('.container').forEach((element) => {
                    element.classList.add('darkmode');
                });
                isDark = true;
                document.getElementById('theme-toggle').textContent = 'Light Mode';
            }
            function toggleTheme() {
                document.querySelectorAll('.container').forEach((element) => {
                    if (isDark) {
                        element.classList.remove('darkmode');
                    } else {
                        element.classList.add('darkmode');
                    }
                });
                isDark = !isDark;
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                document.getElementById('theme-toggle').textContent = `${isDark ? 'Light Mode' : 'Dark Mode'}`;
            }

            function changeLocale(language) {
                if (language.value === 'auto') {
                    passageAuth.lang = undefined;
                    return;
                }
                passageAuth.lang = language.value;
            }
            function loadAppId() {
                const storedAppId = localStorage.getItem('passage-app-id');
                if (storedAppId) {
                    appId = storedAppId;
                    document.getElementById('app-id-input').value = storedAppId;
                }
            }
            function changeAppId(id) {
                appId = id;
                localStorage.setItem('passage-app-id', id);
                renderElements();
            }

            function changeElement(element) {
                elementType = element;
                renderElement();
            }

            function renderElements() {
                renderElement();
                renderProfile();
            }

            function renderElement() {
                const authElem = document.getElementById('passage-element-container');
                let passageAuth = undefined;
                switch (elementType) {
                    case 'passage-login':
                        authElem.innerHTML = `<passage-login app-id="${appId}" default-country-code="us"></passage-login>`;
                        passageAuth = document.querySelector('passage-login');
                        break;
                    case 'passage-register':
                        authElem.innerHTML = `<passage-register app-id="${appId}" default-country-code="us"></passage-register>`;
                        passageAuth = document.querySelector('passage-register');
                        break;
                    case 'passage-auth':
                    default:
                        authElem.innerHTML = `<passage-auth app-id="${appId}" default-country-code="us"></passage-auth>`;
                        passageAuth = document.querySelector('passage-auth');
                }

                // Enable this to see an example when onSuccess is set
                // passageAuth.onSuccess = onSuccess;
                // passageAuth.beforeAuth = beforeAuth;
                // passageAuth.onEvent = onEvent;

                // Enable this line to see an example of when a custom tokenStore is set
                // passageAuth.tokenStore = customTokenStore;
            }

            function renderProfile() {
                const profileElem = document.getElementById('passage-profile-container');
                profileElem.innerHTML = `<passage-profile app-id="${appId}" default-country-code="us"></passage-profile>`;

                // Enable these two lines to see an example of when a custom tokenStore is set
                // passageProfile = document.querySelector('passage-profile');
                // passageProfile.tokenStore = customTokenStore;
            }
        </script>
        <!-- built files will be auto injected -->
    </body>
</html>
