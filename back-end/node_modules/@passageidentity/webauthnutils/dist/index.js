var s=(a,e,t)=>new Promise((r,i)=>{var o=l=>{try{d(t.next(l))}catch(p){i(p)}},y=l=>{try{d(t.throw(l))}catch(p){i(p)}},d=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,y);d((t=t.apply(a,e)).next())});var g=(a,e)=>s(void 0,null,function*(){let t,r=new Promise(i=>{t=setTimeout(i,e)});return Promise.race([a,r]).then(i=>(clearTimeout(t),i))});var n=class{static encodeBytes(e){let r=btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\+/g,"-").replace(/\//g,"_");return C(r)}static decodeBytes(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=C(t);return Uint8Array.from(atob(r),o=>o.charCodeAt(0))}},C=a=>{let e=a.indexOf("=");return a.slice(0,e===-1?a.length:e)};var c=class{static createCredentialAvailable(){return s(this,null,function*(){let e={securityKey:!1,platform:!1,isAvailable:!1};return window.PublicKeyCredential&&(e.securityKey=!0,e.isAvailable=!0,yield g(window.PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable().then(t=>{e.platform=t}).catch(()=>console.log("Something went wrong.")),1e3)),e})}static parsePublicKey(e){if(e.challenge=n.decodeBytes(e.challenge.toString()),e.user.id=n.decodeBytes(e.user.id.toString()),e.excludeCredentials)for(let t=0;t<e.excludeCredentials.length;t++){let r=e.excludeCredentials[t];r.id=n.decodeBytes(r.id.toString())}return e}static getTransports(e){let t=[];return e.response.getTransports&&typeof e.response.getTransports=="function"&&(t=e.response.getTransports()),t}static createCredential(e){return s(this,null,function*(){let t={credential:null,transports:[]},r=this.parsePublicKey(e),i=yield navigator.credentials.create({publicKey:r}).then(o=>o);return i==null||(t.credential=i,t.transports=this.getTransports(i)),t})}};import f from"ua-parser-js";var u=class{constructor(){this.userAgent=new f}getSyncedCredential(){return!!(this._isiOSPasskeySupported()||this._isMacPasskeySupported()||this._isChromeSyncedCredential())}getCrossDeviceCredential(){return!!(this._isiOSPasskeySupported()||this._isMacPasskeySupported()||this._isChromiumCrossDevice())}_isiOSPasskeySupported(){return this.userAgent.getOS().name=="iOS"&&parseFloat(this.userAgent.getOS().version||"")>=16}_isMacPasskeySupported(){return this.userAgent.getBrowser().name=="Safari"&&parseFloat(this.userAgent.getBrowser().version||"")>=16&&this.userAgent.getOS().name=="Mac OS"}_isChromeSyncedCredential(){var r;let e=(r=this.userAgent.getOS().name)!=null?r:"";return((e==null?void 0:e.includes("Windows"))||(e==null?void 0:e.includes("Mac OS"))||(e==null?void 0:e.includes("Android")))&&this.userAgent.getBrowser().name=="Chrome"&&parseFloat(this.userAgent.getBrowser().version||"")>=108}_isChromiumCrossDevice(){return this.userAgent.getOS().name==="Android"?!1:this.userAgent.getEngine().name=="Blink"&&parseFloat(this.userAgent.getBrowser().version||"")>=109}};var m=class{static parsePublicKey(e){if(e.challenge=n.decodeBytes(e.challenge.toString()),e.allowCredentials){for(let t=0;t<e.allowCredentials.length;t++){let r=e.allowCredentials[t];r.id=n.decodeBytes(r.id.toString())}return e}return e}static getCredential(e,t){return s(this,null,function*(){return yield navigator.credentials.get({mediation:t==null?void 0:t.mediation,signal:t==null?void 0:t.signal,publicKey:this.parsePublicKey(e)}).then(i=>i)})}static getCredentialAvailable(){return s(this,null,function*(){let e={securityKey:!1,platform:!1,syncedCredential:!1,crossDeviceCredential:!1,conditionalUI:!1,isAvailable:!1},t=yield c.createCredentialAvailable();if(e.securityKey=t.securityKey,e.platform=t.platform,e.isAvailable=t.isAvailable,!e.securityKey)return e;e.conditionalUI=yield this._isConditionalMediationAvailable();let r=new u;return e.syncedCredential=r.getSyncedCredential(),e.crossDeviceCredential=r.getCrossDeviceCredential(),e})}static _isConditionalMediationAvailable(){return s(this,null,function*(){return PublicKeyCredential.isConditionalMediationAvailable?yield PublicKeyCredential.isConditionalMediationAvailable():!1})}};export{c as CreateCredentialUtils,m as GetCredentialUtils};
//# sourceMappingURL=index.js.map